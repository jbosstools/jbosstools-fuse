<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Spark Rest Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="spark-component.html" title="Apache Spark Component"><link rel="next" href="spel-language.html" title="SpEL Language"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="spark-rest-component"></a>Spark Rest Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="spark-rest-component.html#_uri_format_182">URI format</a></span></dt><dt><span class="section"><a href="spark-rest-component.html#_uri_options_49">URI Options</a></span></dt><dt><span class="section"><a href="spark-rest-component.html#_path_using_spark_syntax">Path using Spark syntax</a></span></dt><dt><span class="section"><a href="spark-rest-component.html#_mapping_to_camel_message">Mapping to Camel Message</a></span></dt><dt><span class="section"><a href="spark-rest-component.html#_rest_dsl">Rest DSL</a></span></dt><dt><span class="section"><a href="spark-rest-component.html#_more_examples_3">More examples</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.14</strong></span></p><p>The Spark-rest component allows to define REST endpoints using the
<a class="link" href="http://sparkjava.com/" target="_top">Spark REST Java library</a> using the
Rest DSL.</p><p>INFO: Spark Java requires Java 8 runtime.</p><p>Maven users will need to add the following dependency to their pom.xml
for this component:</p><pre class="programlisting"> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-spark-rest<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>${camel-version}<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_182"></a>URI format</h2></div></div></div><pre class="programlisting">spark-rest://verb:path?[options]</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_options_49"></a>URI Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="spark-rest-component.html#_path_parameters_2_parameters_46">Path Parameters (2 parameters):</a></span></dt><dt><span class="section"><a href="spark-rest-component.html#_query_parameters_11_parameters_8">Query Parameters (11 parameters):</a></span></dt></dl></div><p>The Spark Rest component supports 12 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>port</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Port number. Will by default use 4567</p></td><td align="center" valign="top"><p>4567</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>ipAddress</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Set the IP address that Spark should listen on. If not called the default address is '0.0.0.0'.</p></td><td align="center" valign="top"><p>0.0.0.0</p></td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>minThreads</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Minimum number of threads in Spark thread-pool (shared globally)</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>maxThreads</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Maximum number of threads in Spark thread-pool (shared globally)</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>timeOutMillis</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Thread idle timeout in millis where threads that has been idle for a longer period will be terminated from the thread pool</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>keystoreFile</strong></span> (security)</p></td><td align="left" valign="top"><p>Configures connection to be secure to use the keystore file</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>keystorePassword</strong></span> (security)</p></td><td align="left" valign="top"><p>Configures connection to be secure to use the keystore password</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>truststoreFile</strong></span> (security)</p></td><td align="left" valign="top"><p>Configures connection to be secure to use the truststore file</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>truststorePassword</strong></span> (security)</p></td><td align="left" valign="top"><p>Configures connection to be secure to use the truststore password</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sparkConfiguration</strong></span> (advanced)</p></td><td align="left" valign="top"><p>To use the shared SparkConfiguration</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>SparkConfiguration</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sparkBinding</strong></span> (advanced)</p></td><td align="left" valign="top"><p>To use a custom SparkBinding to map to/from Camel message.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>SparkBinding</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resolveProperty Placeholders</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether the component should resolve property placeholders on itself when starting. Only properties which are of String type can use property placeholders.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div><p>The Spark Rest endpoint is configured using URI syntax:</p><pre class="screen">spark-rest:verb:path</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_2_parameters_46"></a>Path Parameters (2 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>verb</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> get, post, put, patch, delete, head, trace, connect, or options.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>path</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The content path which support Spark syntax.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_11_parameters_8"></a>Query Parameters (11 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>accept</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Accept type such as: 'text/xml', or 'application/json'. By default we accept all kinds of types.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>disableStreamCache</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Determines whether or not the raw input stream from Spark HttpRequestgetContent() is cached or not (Camel will read the stream into a in light-weight memory based Stream caching) cache. By default Camel will cache the Netty input stream to support reading it multiple times to ensure Camel can retrieve all data from the stream. However you can set this option to true when you for example need to access the raw stream, such as streaming it directly to a file or other persistent store. Mind that if you enable this option, then you cannot read the Netty stream multiple times out of the box, and you would need manually to reset the reader index on the Spark raw stream.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>mapHeaders</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If this option is enabled, then during binding from Spark to Camel Message then the headers will be mapped as well (eg added as header to the Camel Message as well). You can turn off this option to disable this. The headers can still be accessed from the org.apache.camel.component.sparkrest.SparkMessage message with the method getRequest() that returns the Spark HTTP request instance.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>transferException</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If enabled and an Exchange failed processing on the consumer side, and if the caused Exception was send back serialized in the response as a application/x-java-serialized-object content type. This is by default turned off. If you enable this then be aware that Java will deserialize the incoming data from the request to Java and that can be a potential security risk.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>urlDecodeHeaders</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If this option is enabled, then during binding from Spark to Camel Message then the header values will be URL decoded (eg %20 will be a space character.)</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>matchOnUriPrefix</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether or not the consumer should try to find a target consumer by matching the URI prefix if no exact match is found.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sparkBinding</strong></span> (advanced)</p></td><td align="left" valign="top"><p>To use a custom SparkBinding to map to/from Camel message.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>SparkBinding</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_path_using_spark_syntax"></a>Path using Spark syntax</h2></div></div></div><p>The path option is defined using a Spark REST syntax where you define
the REST context path using support for parameters and splat. See more
details at the <a class="link" href="http://sparkjava.com/readme.html#title1" target="_top">Spark Java Route</a>
documentation.</p><p>The following is a Camel route using a fixed path</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"spark-rest:get:hello"</em></strong>)
  .transform().constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Bye World"</em></strong>);</pre><p>And the following route uses a parameter which is mapped to a Camel
header with the key "me".</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"spark-rest:get:hello/:me"</em></strong>)
  .transform().simple(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Bye ${header.me}"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_mapping_to_camel_message"></a>Mapping to Camel Message</h2></div></div></div><p>The Spark Request object is mapped to a Camel Message as
a&nbsp;<code class="literal">org.apache.camel.component.sparkrest.SparkMessage</code> which has access
to the raw Spark request using the getRequest method. By default the
Spark body is mapped to Camel message body, and any HTTP headers / Spark
parameters is mapped to Camel Message headers. There is special support
for the Spark splat syntax, which is mapped to the Camel message header
with key splat.</p><p>For example the given route below uses Spark splat (the asterisk
sign)&nbsp;in the context path which we can access as a header form the
Simple language to construct a response message.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"spark-rest:get:/hello/*/to/*"</em></strong>)
  .transform().simple(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Bye big ${header.splat[1]} from ${header.splat[0]}"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_rest_dsl"></a>Rest DSL</h2></div></div></div><p>Apache Camel provides a new Rest DSL that allow to define the REST
services in a nice REST style. For example we can define a REST hello
service as shown below:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> RouteBuilder() {
    <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Override</span></em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> configure() <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">throws</strong> Exception {
          rest(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"/hello/{me}"</em></strong>).get()
              .route().transform().simple(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Bye ${header.me}"</em></strong>);
      }
  };</pre><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;rest</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"/hello/{me}"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;get&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;transform&gt;</strong>
          <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;simple&gt;</strong>Bye ${header.me}<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/simple&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/transform&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/get&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/rest&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre><p>See more details at the&nbsp;Rest DSL.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_more_examples_3"></a>More examples</h2></div></div></div><p>There is a <span class="strong"><strong>camel-example-spark-rest-tomcat</strong></span> example in the Apache Camel
distribution, that demonstrates how to use camel-spark-rest in a web
application that can be deployed on Apache Tomcat, or similar web
containers.</p></div></div></body></html>