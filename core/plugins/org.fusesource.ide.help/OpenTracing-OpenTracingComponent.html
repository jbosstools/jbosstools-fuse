<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>OpenTracing Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="openstack-swift-component.html" title="OpenStack Swift Component"><link rel="next" href="optaplanner-component.html" title="OptaPlanner Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="OpenTracing-OpenTracingComponent"></a>OpenTracing Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="OpenTracing-OpenTracingComponent.html#_configuration_3">Configuration</a></span></dt><dt><span class="section"><a href="OpenTracing-OpenTracingComponent.html#_example_15">Example</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel 2.19</strong></span></p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="imagesdb/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Starting with Camel 2.21, it will be necessary to use an OpenTracing complaint tracer that is
compatible with OpenTracing Java API version 0.31 or higher.</p></td></tr></table></div><p>The camel-opentracing component is used for tracing and timing incoming and
outgoing Camel messages using <a class="link" href="http://opentracing.io/" target="_top">OpenTracing</a>.</p><p>Events (spans) are captured for incoming and outgoing messages being sent
to/from Camel.</p><p>See the <a class="link" href="http://opentracing.io/" target="_top">OpenTracing</a> website for a list of supported tracers.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_configuration_3"></a>Configuration</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="OpenTracing-OpenTracingComponent.html#_explicit_2">Explicit</a></span></dt><dt><span class="section"><a href="OpenTracing-OpenTracingComponent.html#_spring_boot">Spring Boot</a></span></dt><dt><span class="section"><a href="OpenTracing-OpenTracingComponent.html#_java_agent">Java Agent</a></span></dt></dl></div><p>The configuration properties for the OpenTracing tracer are:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Option</th><th align="left" valign="top">Default</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>excludePatterns</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p>Sets exclude pattern(s) that will disable tracing for Camel
messages that matches the pattern. The content is a Set&lt;String&gt; where the key is a pattern. The pattern
uses the rules from Intercept.</p></td></tr></tbody></table></div><p>There are three ways in which an OpenTracing tracer can be configured to provide distributed tracing for a Camel application:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_explicit_2"></a>Explicit</h3></div></div></div><p>Include the <code class="literal">camel-opentracing</code> component in your POM, along with any specific dependencies associated with the chosen OpenTracing compliant Tracer.</p><p>To explicitly configure OpenTracing support, instantiate the <code class="literal">OpenTracingTracer</code> and initialize the camel
context. You can optionally specify a <code class="literal">Tracer</code>, or alternatively it can be implicitly discovered using the
<code class="literal">Registry</code> or <code class="literal">ServiceLoader</code>.</p><pre class="programlisting">OpenTracingTracer ottracer = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> OpenTracingTracer();
<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// By default it uses a Noop Tracer, but you can override it with a specific OpenTracing implementation.</em>
ottracer.setTracer(...);
<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// And then initialize the context</em>
ottracer.init(camelContext);</pre><p>To use OpenTracingTracer in XML, all you need to do is to define the
OpenTracing tracer beans. Camel will automatically discover and use them.</p><pre class="programlisting">  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"tracer"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"..."</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"ottracer"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.opentracing.OpenTracingTracer"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"tracer"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"tracer"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_spring_boot"></a>Spring Boot</h3></div></div></div><p>If you are using&nbsp;Spring Boot then you can add
the&nbsp;<code class="literal">camel-opentracing-starter</code> dependency, and turn on OpenTracing by annotating
the main class with <code class="literal">@CamelOpenTracing</code>.</p><p>The <code class="literal">Tracer</code> will be implicitly obtained from the camel context&#8217;s <code class="literal">Registry</code>, or the <code class="literal">ServiceLoader</code>, unless
a <code class="literal">Tracer</code> bean has been defined by the application.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_java_agent"></a>Java Agent</h3></div></div></div><p>The third approach is to use a Java Agent to automatically configure the OpenTracing support.</p><p>Include the <code class="literal">camel-opentracing</code> component in your POM, along with any specific dependencies associated with the chosen OpenTracing compliant Tracer.</p><p>The OpenTracing Java Agent is associated with the following dependency:</p><pre class="programlisting">    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>io.opentracing.contrib<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>opentracing-agent<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><p>The <code class="literal">Tracer</code> used will be implicitly loaded from the camel context <code class="literal">Registry</code> or using the <code class="literal">ServiceLoader</code>.</p><p>How this agent is used will be specific to how you execute your application. <span class="emphasis"><em>Service2</em></span> in the <a class="link" href="https://github.com/apache/camel/tree/master/examples/camel-example-opentracing" target="_top">camel-example-opentracing</a> downloads the agent into a local folder and then uses the <code class="literal">exec-maven-plugin</code> to launch the service with the <code class="literal">-javaagent</code> command line option.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_example_15"></a>Example</h2></div></div></div><p>You can find an example demonstrating the three ways to configure OpenTracing here:
<a class="link" href="https://github.com/apache/camel/tree/master/examples/camel-example-opentracing" target="_top">camel-example-opentracing</a></p></div></div></body></html>