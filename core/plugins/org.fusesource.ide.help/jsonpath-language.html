<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>JsonPath Language</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="json-xstream-dataformat.html" title="JSon XStream DataFormat"><link rel="next" href="jt400-component.html" title="JT400 Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="jsonpath-language"></a>JsonPath Language</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="jsonpath-language.html#_jsonpath_options">JSonPath Options</a></span></dt><dt><span class="section"><a href="jsonpath-language.html#_using_xml_configuration">Using XML configuration</a></span></dt><dt><span class="section"><a href="jsonpath-language.html#_syntax_2">Syntax</a></span></dt><dt><span class="section"><a href="jsonpath-language.html#_easy_syntax_2">Easy Syntax</a></span></dt><dt><span class="section"><a href="jsonpath-language.html#_supported_message_body_types_2">Supported message body types</a></span></dt><dt><span class="section"><a href="jsonpath-language.html#_suppress_exceptions_2">Suppress exceptions</a></span></dt><dt><span class="section"><a href="jsonpath-language.html#_inline_simple_exceptions">Inline Simple exceptions</a></span></dt><dt><span class="section"><a href="jsonpath-language.html#_jsonpath_injection_2">JSonPath injection</a></span></dt><dt><span class="section"><a href="jsonpath-language.html#_encoding_detection">Encoding Detection</a></span></dt><dt><span class="section"><a href="jsonpath-language.html#_split_json_data_into_sub_rows_as_json">Split JSon data into sub rows as JSon</a></span></dt><dt><span class="section"><a href="jsonpath-language.html#_using_header_as_input">Using header as input</a></span></dt><dt><span class="section"><a href="jsonpath-language.html#_dependencies_44">Dependencies</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.13</strong></span></p><p>Camel supports <a class="link" href="https://code.google.com/p/json-path/" target="_top">JSonPath</a> to allow
using Expression or Predicate
on json messages.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"queue:books.new"</em></strong>)
  .choice()
    .when().jsonpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"$.store.book[?(@.price &lt; 10)]"</em></strong>)
      .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jms:queue:book.cheap"</em></strong>)
    .when().jsonpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"$.store.book[?(@.price &lt; 30)]"</em></strong>)
      .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jms:queue:book.average"</em></strong>)
    .otherwise()
      .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jms:queue:book.expensive"</em></strong>)</pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_jsonpath_options"></a>JSonPath Options</h2></div></div></div><p>The JsonPath language supports 7 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="11%" class="col_2"><col width="10%" class="col_3"><col width="60%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Default</th><th align="left" valign="top">Java Type</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>resultType</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>Sets the class name of the result type (type from output)</p></td></tr><tr><td align="left" valign="top"><p>suppressExceptions</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>Whether to suppress exceptions such as PathNotFoundException.</p></td></tr><tr><td align="left" valign="top"><p>allowSimple</p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>Whether to allow in inlined simple exceptions in the JsonPath expression</p></td></tr><tr><td align="left" valign="top"><p>allowEasyPredicate</p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>Whether to allow using the easy predicate parser to pre-parse predicates.</p></td></tr><tr><td align="left" valign="top"><p>writeAsString</p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>Whether to write the output of each row/element as a JSON String value instead of a Map/POJO value.</p></td></tr><tr><td align="left" valign="top"><p>headerName</p></td><td align="left" valign="top">&nbsp;</td><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>Name of header to use as input, instead of the message body</p></td></tr><tr><td align="left" valign="top"><p>trim</p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><code class="literal">Boolean</code></p></td><td align="left" valign="top"><p>Whether to trim the value to remove leading and trailing whitespaces and line breaks</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_xml_configuration"></a>Using XML configuration</h2></div></div></div><p>If you prefer to configure your routes in your Spring
XML file then you can use <a class="link" href="jsonpath-language.html" title="JsonPath Language">JSonPath</a> expressions as
follows</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"direct:start"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;choice&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;when&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jsonpath&gt;</strong>$.store.book[?(@.price &amp;lt; 10)]<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/jsonpath&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mock:cheap"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/when&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;when&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jsonpath&gt;</strong>$.store.book[?(@.price &amp;lt; 30)]<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/jsonpath&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mock:average"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/when&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;otherwise&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mock:expensive"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/otherwise&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/choice&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_syntax_2"></a>Syntax</h2></div></div></div><p>See the <a class="link" href="https://code.google.com/p/json-path/" target="_top">JSonPath</a> project page for
further examples.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_easy_syntax_2"></a>Easy Syntax</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.19</strong></span></p><p>When you just want to define a basic predicate using jsonpath syntax it can be a bit hard to remember the syntax.
 So for example to find out all the cheap books you have to do</p><pre class="screen">$.store.book[?(@.price &lt; 20)]</pre><p>However what if you could just write it as</p><pre class="screen">store.book.price &lt; 20</pre><p>And you can omit the path if you just want to look at nodes with a price key</p><pre class="screen">price &lt; 20</pre><p>To support this there is a <code class="literal">EasyPredicateParser</code> which kicks-in if you have define the predicate
  using a basic style. That means the predicate must not start with the <code class="literal">$</code> sign, and only include one operator.</p><p>The easy syntax is:</p><pre class="screen">left OP right</pre><p>You can use Camel simple language in the right operator, eg</p><pre class="screen">store.book.price &lt; ${header.limit}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_supported_message_body_types_2"></a>Supported message body types</h2></div></div></div><p>Camel JSonPath supports message body using the following types:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="30%" class="col_1"><col width="70%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Type</th><th align="left" valign="top">Comment</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">File</code></p></td><td align="left" valign="top"><p>Reading from files</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">String</code></p></td><td align="left" valign="top"><p>Plain strings</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Map</code></p></td><td align="left" valign="top"><p>Message bodies as <code class="literal">java.util.Map</code> types</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">List</code></p></td><td align="left" valign="top"><p>Message bodies as <code class="literal">java.util.List</code> types</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">POJO</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Optional</strong></span> If Jackson is on the classpath, then camel-jsonpath
  is able to use Jackson to read the message body as POJO and convert to <code class="literal">java.util.Map</code>
  which is supported by JSonPath. For example you can add <code class="literal">camel-jackson</code> as dependency to include Jackson.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">InputStream</code></p></td><td align="left" valign="top"><p>If none of the above types matches, then Camel will attempt to read the message body as an <code class="literal">java.io.InputStream</code>.</p></td></tr></tbody></table></div><p>If a message body is of unsupported type then an exception is thrown by default, however you
can configure JSonPath to suppress exceptions (see below)</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_suppress_exceptions_2"></a>Suppress exceptions</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.16</strong></span></p><p>By default jsonpath will throw an exception if the json payload does not
have a valid path accordingly to the configured jsonpath expression. In
some use-cases you may want to ignore this in case the json payload
contains optional data. Therefore you can set the option
suppressExceptions to true to ignore this as shown:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
    .choice()
        <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// use true to suppress exceptions</em>
        .when().jsonpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"person.middlename"</em></strong>, true)
            .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:middle"</em></strong>)
        .otherwise()
            .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:other"</em></strong>);</pre><p>And in XML DSL:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"direct:start"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;choice&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;when&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jsonpath</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">suppressExceptions</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>person.middlename<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/jsonpath&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mock:middle"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/when&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;otherwise&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mock:other"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/otherwise&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/choice&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong></pre><p>This option is also available on the&nbsp;<code class="literal">@JsonPath</code>&nbsp;annotation.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_inline_simple_exceptions"></a>Inline Simple exceptions</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.18</strong></span></p><p>Its now possible to inlined Simple language expressions in the JSonPath expression using the simple syntax ${xxx}.
An example is shown below:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
  .choice()
    .when().jsonpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"$.store.book[?(@.price &lt; ${header.cheap})]"</em></strong>)
      .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:cheap"</em></strong>)
    .when().jsonpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"$.store.book[?(@.price &lt; ${header.average})]"</em></strong>)
      .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:average"</em></strong>)
    .otherwise()
      .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:expensive"</em></strong>);</pre><p>And in XML DSL:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"direct:start"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;choice&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;when&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jsonpath&gt;</strong>$.store.book[?(@.price <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">${header.cheap})]&lt;/jsonpath&gt;</span>
      <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">&lt;to</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mock:cheap"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/when&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;when&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jsonpath&gt;</strong>$.store.book[?(@.price <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">${header.average})]&lt;/jsonpath&gt;</span>
      <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">&lt;to</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mock:average"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/when&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;otherwise&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mock:expensive"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/otherwise&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/choice&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong></pre><p>You can turn off support for inlined simple expression by setting the option allowSimple to false as shown:</p><pre class="programlisting">.when().jsonpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"$.store.book[?(@.price &lt; 10)]"</em></strong>, false, false)</pre><p>And in XML DSL:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jsonpath</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">allowSimple</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"false"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>$.store.book[?(@.price <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">10)]&lt;/jsonpath&gt;</span></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_jsonpath_injection_2"></a>JSonPath injection</h2></div></div></div><p>You can use Bean Integration to invoke a
method on a bean and use various languages such as JSonPath to extract a
value from the message and bind it to a method parameter.</p><p>For example</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> Foo {

    <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Consume(uri = "activemq:queue:books.new")</span></em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">void</strong> doSomething(<em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@JsonPath("$.store.book[*].author")</span></em> String author, <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@Body</span></em> String json) {
      <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// process the inbound message here</em>
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_encoding_detection"></a>Encoding Detection</h2></div></div></div><p><span class="strong"><strong>Since Camel version 2.16</strong></span>, the encoding of the JSON document is
detected automatically, if the document is encoded in unicode &nbsp;(UTF-8,
UTF-16LE, UTF-16BE, UTF-32LE, UTF-32BE ) as specified in &nbsp;RFC-4627. If
the encoding is a non-unicode encoding, you can either make sure that
you enter the document in String format to the JSONPath component or you
can specify the encoding in the header&nbsp;"<span class="strong"><strong>CamelJsonPathJsonEncoding</strong></span>"
(JsonpathConstants.HEADER_JSON_ENCODING).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_split_json_data_into_sub_rows_as_json"></a>Split JSon data into sub rows as JSon</h2></div></div></div><p>You can use jsonpath to split a JSon document, such as:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
    .split().jsonpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"$.store.book[*]"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"log:book"</em></strong>);</pre><p>Then each book is logged, however the message body is a <code class="literal">Map</code> instance. Sometimes
you may want to output this as plain String JSon value instead, which can be done
from <span class="strong"><strong>Camel 2.20</strong></span> onwards with the <code class="literal">writeAsString</code> option as shown:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
    .split().jsonpathWriteAsString(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"$.store.book[*]"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"log:book"</em></strong>);</pre><p>Then each book is logged as a String JSon value. For earlier versions of Camel you
would need to use camel-jackson dataformat and marshal the message body to make it
convert the message body from <code class="literal">Map</code> to a <code class="literal">String</code> type.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_header_as_input"></a>Using header as input</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.20</strong></span></p><p>By default jsonpath uses the message body as the input source. However you can also use a header as input
by specifying the <code class="literal">headerName</code> option.</p><p>For example to count the number of books from a json document that
was stored in a header named <code class="literal">books</code> you can do:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:start"</em></strong>)
    .setHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"numberOfBooks"</em></strong>)
        .jsonpath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"$..store.book.length()"</em></strong>, false, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">int</strong>.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"books"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:result"</em></strong>);</pre><p>In the <code class="literal">jsonpath</code> expression above we specify the name of the header as <code class="literal">books</code>
and we also told that we wanted the result to be converted as an integer by <code class="literal">int.class</code>.</p><p>The same example in XML DSL would be:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"direct:start"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;setHeader</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">headerName</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"numberOfBooks"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jsonpath</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">headerName</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"books"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">resultType</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"int"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>$..store.book.length()<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/jsonpath&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/transform&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mock:result"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_dependencies_44"></a>Dependencies</h2></div></div></div><p>To use JSonPath in your camel routes you need to add the a dependency on
<span class="strong"><strong>camel-jsonpath</strong></span> which implements the JSonPath language.</p><p>If you use maven you could just add the following to your pom.xml,
substituting the version number for the latest &amp; greatest release (see
the download page for the latest versions).</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-jsonpath<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre></div></div></body></html>