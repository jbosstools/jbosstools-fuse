<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>ZooKeeper Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="Zipkin-ZipkinComponent.html" title="Zipkin Component"><link rel="next" href="zookeeper-master-component.html" title="ZooKeeper Master Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="zookeeper-component"></a>ZooKeeper Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="zookeeper-component.html#_uri_format_218">URI format</a></span></dt><dt><span class="section"><a href="zookeeper-component.html#_options_178">Options</a></span></dt><dt><span class="section"><a href="zookeeper-component.html#_use_cases_8">Use cases</a></span></dt><dt><span class="section"><a href="zookeeper-component.html#_zookeeper_enabled_route_policies">ZooKeeper enabled Route policies</a></span></dt><dt><span class="section"><a href="zookeeper-component.html#_see_also_150">See Also</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.9</strong></span></p><p>The ZooKeeper component allows interaction with a
<a class="link" href="http://hadoop.apache.org/zookeeper/" target="_top">ZooKeeper</a> cluster and exposes the
following features to Camel:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Creation of nodes in any of the ZooKeeper create modes.</li><li class="listitem">Get and Set the data contents of arbitrary cluster nodes (data
being set must be convertible to <code class="literal">byte[]</code>).</li><li class="listitem">Create and retrieve the list the child nodes attached to a
particular node.</li><li class="listitem">A Distributed <code class="literal">RoutePolicy</code> that leverages a
Leader election coordinated by ZooKeeper to determine if exchanges
should get processed.</li></ol></div><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-zookeeper<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_218"></a>URI format</h2></div></div></div><pre class="screen">zookeeper://zookeeper-server[:port][/path][?options]</pre><p>The path from the URI specifies the node in the ZooKeeper server (a.k.a.
<span class="emphasis"><em>znode</em></span>) that will be the target of the endpoint:</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_178"></a>Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="zookeeper-component.html#_path_parameters_2_parameters_53">Path Parameters (2 parameters):</a></span></dt><dt><span class="section"><a href="zookeeper-component.html#_query_parameters_12_parameters_10">Query Parameters (12 parameters):</a></span></dt></dl></div><p>The ZooKeeper component supports 2 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>configuration</strong></span> (advanced)</p></td><td align="left" valign="top"><p>To use a shared ZooKeeperConfiguration</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ZooKeeperConfiguration</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resolveProperty Placeholders</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether the component should resolve property placeholders on itself when starting. Only properties which are of String type can use property placeholders.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div><p>The ZooKeeper endpoint is configured using URI syntax:</p><pre class="screen">zookeeper:serverUrls/path</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_2_parameters_53"></a>Path Parameters (2 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>serverUrls</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The zookeeper server hosts (multiple servers can be separated by comma)</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>path</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The node in the ZooKeeper server (aka znode)</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_12_parameters_10"></a>Query Parameters (12 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>awaitExistence</strong></span> (common)</p></td><td align="left" valign="top"><p><span class="strong"><strong>Deprecated</strong></span> Not in use</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>listChildren</strong></span> (common)</p></td><td align="left" valign="top"><p>Whether the children of the node should be listed</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>timeout</strong></span> (common)</p></td><td align="left" valign="top"><p>The time interval to wait on connection before timing out.</p></td><td align="center" valign="top"><p>5000</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>backoff</strong></span> (consumer)</p></td><td align="left" valign="top"><p>The time interval to backoff for after an error before retrying.</p></td><td align="center" valign="top"><p>5000</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>repeat</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Should changes to the znode be 'watched' and repeatedly processed.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sendEmptyMessageOnDelete</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Upon the delete of a znode, should an empty message be send to the consumer</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>create</strong></span> (producer)</p></td><td align="left" valign="top"><p>Should the endpoint create the node if it does not currently exist.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>createMode</strong></span> (producer)</p></td><td align="left" valign="top"><p>The create mode that should be used for the newly created node</p></td><td align="center" valign="top"><p>EPHEMERAL</p></td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_use_cases_8"></a>Use cases</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="zookeeper-component.html#_reading_from_a_emphasis_znode_emphasis">Reading from a <span class="emphasis"><em>znode</em></span></a></span></dt><dt><span class="section"><a href="zookeeper-component.html#_reading_from_a_emphasis_znode_emphasis_additional_camel_2_10_onwards">Reading from a <span class="emphasis"><em>znode</em></span> (additional Camel 2.10 onwards)</a></span></dt><dt><span class="section"><a href="zookeeper-component.html#_writing_to_a_emphasis_znode_emphasis">Writing to a <span class="emphasis"><em>znode</em></span></a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_reading_from_a_emphasis_znode_emphasis"></a>Reading from a <span class="emphasis"><em>znode</em></span></h3></div></div></div><p>The following snippet will read the data from the <span class="emphasis"><em>znode</em></span>
<code class="literal">/somepath/somenode/</code> provided that it already exists. The data
retrieved will be placed into an exchange and passed onto
the rest of the route:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"zookeeper://localhost:39913/somepath/somenode"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:result"</em></strong>);</pre><p>If the node does not yet exist then a flag can be supplied to have the
endpoint await its creation:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"zookeeper://localhost:39913/somepath/somenode?awaitCreation=true"</em></strong>).to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:result"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_reading_from_a_emphasis_znode_emphasis_additional_camel_2_10_onwards"></a>Reading from a <span class="emphasis"><em>znode</em></span> (additional Camel 2.10 onwards)</h3></div></div></div><p>When data is read due to a <code class="literal">WatchedEvent</code> received from the ZooKeeper
ensemble, the <code class="literal">CamelZookeeperEventType</code> header holds ZooKeeper&#8217;s
<a class="link" href="http://zookeeper.apache.org/doc/current/api/org/apache/zookeeper/Watcher.Event.EventType.html" target="_top"><code class="literal">EventType</code></a>
value from that <code class="literal">WatchedEvent</code>. If the data is read initially (not
triggered by a <code class="literal">WatchedEvent</code>) the <code class="literal">CamelZookeeperEventType</code> header will not
be set.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_writing_to_a_emphasis_znode_emphasis"></a>Writing to a <span class="emphasis"><em>znode</em></span></h3></div></div></div><p>The following snippet will write the payload of the exchange into the
znode at <code class="literal">/somepath/somenode/</code> provided that it already exists:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:write-to-znode"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"zookeeper://localhost:39913/somepath/somenode"</em></strong>);</pre><p>For flexibility, the endpoint allows the target <span class="emphasis"><em>znode</em></span> to be specified
dynamically as a message header. If a header keyed by the string
<code class="literal">CamelZooKeeperNode</code> is present then the value of the header will be
used as the path to the <span class="emphasis"><em>znode</em></span> on the server. For instance using the same
route definition above, the following code snippet will write the data
not to <code class="literal">/somepath/somenode</code> but to the path from the header
<code class="literal">/somepath/someothernode</code>.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="imagesdb/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>the <code class="literal">testPayload</code> must be convertible
to <code class="literal">byte[]</code> as the data stored in ZooKeeper is byte based.</p></td></tr></table></div><pre class="programlisting">Object testPayload = ...
template.sendBodyAndHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:write-to-znode"</em></strong>, testPayload, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"CamelZooKeeperNode"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"/somepath/someothernode"</em></strong>);</pre><p>To also create the node if it does not exist the <code class="literal">create</code> option should
be used.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:create-and-write-to-znode"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"zookeeper://localhost:39913/somepath/somenode?create=true"</em></strong>);</pre><p>Starting <span class="strong"><strong>version 2.11</strong></span> it is also possible to <span class="strong"><strong>delete</strong></span> a node using the
header <code class="literal">CamelZookeeperOperation</code> by setting it to <code class="literal">DELETE</code>:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:delete-znode"</em></strong>)
    .setHeader(ZooKeeperMessage.ZOOKEEPER_OPERATION, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"DELETE"</em></strong>))
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"zookeeper://localhost:39913/somepath/somenode"</em></strong>);</pre><p>or equivalently:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"direct:delete-znode"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096"> /&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;setHeader</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">headerName</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"CamelZookeeperOperation"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
     <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;constant&gt;</strong>DELETE<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/constant&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/setHeader&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"zookeeper://localhost:39913/somepath/somenode"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096"> /&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong></pre><p>ZooKeeper nodes can have different types; they can be 'Ephemeral' or
'Persistent' and 'Sequenced' or 'Unsequenced'. For further information
of each type you can check
<a class="link" href="http://zookeeper.apache.org/doc/trunk/zookeeperProgrammers.html#Ephemeral+Nodes" target="_top">here</a>.
By default endpoints will create unsequenced, ephemeral nodes, but the
type can be easily manipulated via a uri config parameter or via a
special message header. The values expected for the create mode are
simply the names from the <code class="literal">CreateMode</code> enumeration:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">PERSISTENT</code></li><li class="listitem"><code class="literal">PERSISTENT_SEQUENTIAL</code></li><li class="listitem"><code class="literal">EPHEMERAL</code></li><li class="listitem"><code class="literal">EPHEMERAL_SEQUENTIAL</code></li></ul></div><p>For example to create a persistent <span class="emphasis"><em>znode</em></span> via the URI config:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:create-and-write-to-persistent-znode"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"zookeeper://localhost:39913/somepath/somenode?create=true&amp;createMode=PERSISTENT"</em></strong>);</pre><p>or using the header <code class="literal">CamelZookeeperCreateMode</code>.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="imagesdb/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>the <code class="literal">testPayload</code> must be convertible to <code class="literal">byte[]</code> as the data stored in
ZooKeeper is byte based.</p></td></tr></table></div><pre class="programlisting">Object testPayload = ...
template.sendBodyAndHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:create-and-write-to-persistent-znode"</em></strong>, testPayload, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"CamelZooKeeperCreateMode"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"PERSISTENT"</em></strong>);</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_zookeeper_enabled_route_policies"></a>ZooKeeper enabled Route policies</h2></div></div></div><p>ZooKeeper allows for very simple and effective leader election out of
the box. This component exploits this election capability in a
<code class="literal">RoutePolicy</code> to control when and how routes are
enabled. This policy would typically be used in fail-over scenarios, to
control identical instances of a route across a cluster of Camel based
servers. A very common scenario is a simple 'Master-Slave' setup where
there are multiple instances of a route distributed across a cluster but
only one of them, that of the master, should be running at a time. If
the master fails, a new master should be elected from the available
slaves and the route in this new master should be started.</p><p>The policy uses a common <span class="emphasis"><em>znode</em></span> path across all instances of the
<code class="literal">RoutePolicy</code> that will be involved in the election. Each policy writes
its id into this node and Zookeeper will order the writes in the order
it received them. The policy then reads the listing of the node to see
what position of its id; this position is used to determine if the route
should be started or not. The policy is configured at startup with the
number of route instances that should be started across the cluster and
if its position in the list is less than this value then its route will
be started. For a Master-slave scenario, the route is configured with 1
route instance and only the first entry in the listing will start its
route. All policies watch for updates to the listing and if the listing
changes they recalculate if their route should be started. For more info
on Zookeeper&#8217;s leader election capability see
<a class="link" href="http://zookeeper.apache.org/doc/trunk/recipes.html#sc_leaderElection" target="_top">this
page</a>.</p><p>The following example uses the node <code class="literal">/someapplication/somepolicy</code> for
the election and is set up to start only the top '1' entries in the node
listing i.e. elect a master:</p><pre class="programlisting">ZooKeeperRoutePolicy policy = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> ZooKeeperRoutePolicy(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"zookeeper:localhost:39913/someapp/somepolicy"</em></strong>, <span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">1</span>);
from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:policy-controlled"</em></strong>)
    .routePolicy(policy)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:controlled"</em></strong>);</pre><p>There are currently 3 policies defined in the component, with different SLAs:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">ZooKeeperRoutePolicy</code></li><li class="listitem"><code class="literal">CuratorLeaderRoutePolicy</code> (since <span class="strong"><strong>2.19</strong></span>)</li><li class="listitem"><code class="literal">MultiMasterCuratorLeaderRoutePolicy</code> (since <span class="strong"><strong>2.19</strong></span>)</li></ul></div><p><span class="strong"><strong>ZooKeeperRoutePolicy</strong></span> supports multiple active nodes, but it&#8217;s activation kicks in only after a Camel component and its correspondent Consumer have already been started,
 this introduces, depending on your routes definition, the risk that you component can already start consuming events and producing `Exchange`s, before the policy could estabilish
 that the node should not be activated.</p><p><span class="strong"><strong>CuratorLeaderRoutePolicy</strong></span> supports only a single active node, but it&#8217;s bound to a different <code class="literal">CamelContext</code> lifecycle method; this Policy kicks in before any route or consumer is started
 thus you can be sure that no even is processed before the Policy takes its decision.</p><p><span class="strong"><strong>MultiMasterCuratorLeaderRoutePolicy</strong></span> support multiple active nodes, and it&#8217;s bound to the same lifecycle method as <code class="literal">CuratorLeaderRoutePolicy</code>; this Policy kicks in before any route or consumer is started
 thus you can be sure that no even is processed before the Policy takes its decision.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_see_also_150"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Configuring Camel</li><li class="listitem">Component</li><li class="listitem">Endpoint</li><li class="listitem">Getting Started</li></ul></div></div></div></body></html>