<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>JMX Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="jms-component.html" title="JMS Component"><link rel="next" href="jolt-component.html" title="JOLT Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="jmx-component"></a>JMX Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="jmx-component.html#_camel_jmx">Camel JMX</a></span></dt><dt><span class="section"><a href="jmx-component.html#_options_80">Options</a></span></dt><dt><span class="section"><a href="jmx-component.html#_activating_jmx_in_camel">Activating JMX in Camel</a></span></dt><dt><span class="section"><a href="jmx-component.html#_monitoring_camel_using_jmx">Monitoring Camel using JMX</a></span></dt><dt><span class="section"><a href="jmx-component.html#_using_jmx_for_your_own_camel_code">Using JMX for your own Camel Code</a></span></dt><dt><span class="section"><a href="jmx-component.html#_hiding_sensitive_information">Hiding sensitive information</a></span></dt><dt><span class="section"><a href="jmx-component.html#_see_also_65">See Also</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_camel_jmx"></a>Camel JMX</h2></div></div></div><p>Apache Camel has extensive support for JMX to allow you to monitor and
control the Camel managed objects with a JMX client.</p><p>Camel also provides a <a class="link" href="jmx-component.html" title="JMX Component">JMX</a> component that allows you to
subscribe to MBean notifications. This page is about how to manage and
monitor Camel using JMX.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_80"></a>Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="jmx-component.html#_path_parameters_1_parameters_98">Path Parameters (1 parameters):</a></span></dt><dt><span class="section"><a href="jmx-component.html#_query_parameters_29_parameters_4">Query Parameters (29 parameters):</a></span></dt></dl></div><p>The JMX component has no options.</p><p>The JMX endpoint is configured using URI syntax:</p><pre class="screen">jmx:serverURL</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_1_parameters_98"></a>Path Parameters (1 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>serverURL</strong></span></p></td><td align="left" valign="top"><p>server url comes from the remaining endpoint</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_29_parameters_4"></a>Query Parameters (29 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>format</strong></span> (consumer)</p></td><td align="left" valign="top"><p>URI Property: Format for the message body. Either xml or raw. If xml, the notification is serialized to xml. If raw, then the raw java object is set as the body.</p></td><td align="center" valign="top"><p>xml</p></td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>granularityPeriod</strong></span> (consumer)</p></td><td align="left" valign="top"><p>URI Property: monitor types only The frequency to poll the bean to check the monitor.</p></td><td align="center" valign="top"><p>10000</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>monitorType</strong></span> (consumer)</p></td><td align="left" valign="top"><p>URI Property: monitor types only The type of monitor to create. One of string, gauge, counter.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>objectDomain</strong></span> (consumer)</p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> URI Property: The domain for the mbean you&#8217;re connecting to</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>objectName</strong></span> (consumer)</p></td><td align="left" valign="top"><p>URI Property: The name key for the mbean you&#8217;re connecting to. This value is mutually exclusive with the object properties that get passed.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>observedAttribute</strong></span> (consumer)</p></td><td align="left" valign="top"><p>URI Property: monitor types only The attribute to observe for the monitor bean.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>handback</strong></span> (advanced)</p></td><td align="left" valign="top"><p>URI Property: Value to handback to the listener when a notification is received. This value will be put in the message header with the key jmx.handback</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Object</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>notificationFilter</strong></span> (advanced)</p></td><td align="left" valign="top"><p>URI Property: Reference to a bean that implements the NotificationFilter.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>NotificationFilter</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>objectProperties</strong></span> (advanced)</p></td><td align="left" valign="top"><p>URI Property: properties for the object name. These values will be used if the objectName param is not set</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Map</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>reconnectDelay</strong></span> (advanced)</p></td><td align="left" valign="top"><p>URI Property: The number of seconds to wait before attempting to retry establishment of the initial connection or attempt to reconnect a lost connection</p></td><td align="center" valign="top"><p>10</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>reconnectOnConnection Failure</strong></span> (advanced)</p></td><td align="left" valign="top"><p>URI Property: If true the consumer will attempt to reconnect to the JMX server when any connection failure occurs. The consumer will attempt to re-establish the JMX connection every 'x' seconds until the connection is made-- where 'x' is the configured reconnectionDelay</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>testConnectionOnStartup</strong></span> (advanced)</p></td><td align="left" valign="top"><p>URI Property: If true the consumer will throw an exception if unable to establish the JMX connection upon startup. If false, the consumer will attempt to establish the JMX connection every 'x' seconds until the connection is made&#8201;&#8212;&#8201;where 'x' is the configured reconnectionDelay</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>initThreshold</strong></span> (counter)</p></td><td align="left" valign="top"><p>URI Property: counter monitor only Initial threshold for the monitor. The value must exceed this before notifications are fired.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>modulus</strong></span> (counter)</p></td><td align="left" valign="top"><p>URI Property: counter monitor only The value at which the counter is reset to zero</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>offset</strong></span> (counter)</p></td><td align="left" valign="top"><p>URI Property: counter monitor only The amount to increment the threshold after it&#8217;s been exceeded.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>differenceMode</strong></span> (gauge)</p></td><td align="left" valign="top"><p>URI Property: counter gauge monitor only If true, then the value reported in the notification is the difference from the threshold as opposed to the value itself.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>notifyHigh</strong></span> (gauge)</p></td><td align="left" valign="top"><p>URI Property: gauge monitor only If true, the gauge will fire a notification when the high threshold is exceeded</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>notifyLow</strong></span> (gauge)</p></td><td align="left" valign="top"><p>URI Property: gauge monitor only If true, the gauge will fire a notification when the low threshold is exceeded</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>thresholdHigh</strong></span> (gauge)</p></td><td align="left" valign="top"><p>URI Property: gauge monitor only Value for the gauge&#8217;s high threshold</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Double</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>thresholdLow</strong></span> (gauge)</p></td><td align="left" valign="top"><p>URI Property: gauge monitor only Value for the gauge&#8217;s low threshold</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Double</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>password</strong></span> (security)</p></td><td align="left" valign="top"><p>URI Property: credentials for making a remote connection</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>user</strong></span> (security)</p></td><td align="left" valign="top"><p>URI Property: credentials for making a remote connection</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>notifyDiffer</strong></span> (string)</p></td><td align="left" valign="top"><p>URI Property: string monitor only If true, the string monitor will fire a notification when the string attribute differs from the string to compare.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>notifyMatch</strong></span> (string)</p></td><td align="left" valign="top"><p>URI Property: string monitor only If true, the string monitor will fire a notification when the string attribute matches the string to compare.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>stringToCompare</strong></span> (string)</p></td><td align="left" valign="top"><p>URI Property: string monitor only Value for the string monitor&#8217;s string to compare.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_activating_jmx_in_camel"></a>Activating JMX in Camel</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="jmx-component.html#_using_jmx_to_manage_apache_camel">Using JMX to manage Apache Camel</a></span></dt><dt><span class="section"><a href="jmx-component.html#_disabling_jmx_instrumentation_agent_in_camel">Disabling JMX instrumentation agent in Camel</a></span></dt><dt><span class="section"><a href="jmx-component.html#_locating_a_mbeanserver_in_the_java_vm">Locating a MBeanServer in the Java VM</a></span></dt><dt><span class="section"><a href="jmx-component.html#_creating_jmx_rmi_connector_server">Creating JMX RMI Connector Server</a></span></dt><dt><span class="section"><a href="jmx-component.html#_jmx_service_url">JMX Service URL</a></span></dt><dt><span class="section"><a href="jmx-component.html#_the_system_properties_for_camel_jmx_support">The System Properties for Camel JMX support</a></span></dt><dt><span class="section"><a href="jmx-component.html#_how_to_use_authentication_with_jmx">How to use authentication with JMX</a></span></dt><dt><span class="section"><a href="jmx-component.html#_jmx_inside_an_application_server">JMX inside an Application Server</a></span></dt><dt><span class="section"><a href="jmx-component.html#_advanced_jmx_configuration">Advanced JMX Configuration</a></span></dt><dt><span class="section"><a href="jmx-component.html#_example_9">Example:</a></span></dt><dt><span class="section"><a href="jmx-component.html#_literal_jmxagent_literal_properties_reference"><code class="literal">jmxAgent</code> Properties Reference</a></span></dt><dt><span class="section"><a href="jmx-component.html#_configuring_whether_to_register_mbeans_always_for_new_routes_or_just_by_default">Configuring whether to register MBeans always, for new routes or just by default</a></span></dt></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>Spring JAR dependency, required for Camel 2.8 or older</strong></span></p><p><code class="literal">spring-context.jar</code>, <code class="literal">spring-aop.jar</code>, <code class="literal">spring-beans.jar</code>, and
<code class="literal">spring-core.jar</code> are needed on the classpath by Camel to be able to use
JMX instrumentation. If these .jars are not on the classpath, Camel will
fallback to non JMX mode. This situation is logged at <code class="literal">WARN</code> level using
logger name <code class="literal">org.apache.camel.impl.DefaultCamelContext</code>.</p><p>From <span class="strong"><strong>Camel 2.9</strong></span> onwards, the Spring JARs are <span class="strong"><strong>no</strong></span> longer required to
run Camel in JMX mode.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_using_jmx_to_manage_apache_camel"></a>Using JMX to manage Apache Camel</h3></div></div></div><p>By default, JMX instrumentation agent is enabled in Camel, which means
that Camel runtime creates and registers MBean management objects with a
<code class="literal">MBeanServer</code> instance in the VM. This allows Camel users to instantly
obtain insights into how Camel routes perform down to the individual
processor level.</p><p>The supported types of management objects are
<a class="link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/management/mbean/ManagedEndpoint.html" target="_top">endpoint</a>,
<a class="link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/management/mbean/ManagedRoute.html" target="_top">route</a>,
<a class="link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/management/mbean/ManagedService.html" target="_top">service</a>,
and
<a class="link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/management/mbean/ManagedProcessor.html" target="_top">processor</a>.
Some of these management objects also expose lifecycle operations in
addition to performance counter attributes.</p><p>The
<a class="link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/management/DefaultManagementNamingStrategy.html" target="_top"><code class="literal">DefaultManagementNamingStrategy</code></a>
is the default naming strategy which builds object names used for MBean
registration. By default, <code class="literal">org.apache.camel</code> is the domain name for all
object names created by <code class="literal">CamelNamingStrategy</code>. The domain name of the
MBean object can be configured by Java VM system property:</p><pre class="screen">-Dorg.apache.camel.jmx.mbeanObjectDomainName=your.domain.name</pre><p>Or, by adding a <code class="literal">jmxAgent</code> element inside the camelContext element in
Spring configuration:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jmxAgent</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"agent"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">mbeanObjectDomainName</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"your.domain.name"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    ...
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre><p>Spring configuration always takes precedence over system properties when
they both present. It is true for all JMX related configurations.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_disabling_jmx_instrumentation_agent_in_camel"></a>Disabling JMX instrumentation agent in Camel</h3></div></div></div><p>You can disable JMX instrumentation agent by setting the Java VM system
property as follow:</p><pre class="screen">-Dorg.apache.camel.jmx.disabled=true</pre><p>The property value is treated as <code class="literal">boolean</code>.</p><p>Or, by adding a <code class="literal">jmxAgent</code> element inside the <code class="literal">camelContext</code> element in
Spring configuration:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jmxAgent</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"agent"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">disabled</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    ...
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre><p>Or in <span class="strong"><strong>Camel 2.1</strong></span> its a bit easier (not having to use JVM system
property) if using pure Java as you can disable it as follows:</p><pre class="programlisting">CamelContext camel = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> DefaultCamelContext();
camel.disableJMX();</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_locating_a_mbeanserver_in_the_java_vm"></a>Locating a MBeanServer in the Java VM</h3></div></div></div><p>Each CamelContext can have an instance of
<a class="link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/spi/InstrumentationAgent.html" target="_top"><code class="literal">InstrumentationAgent</code></a>
wrapped inside the
<a class="link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/management/InstrumentationLifecycleStrategy.html" target="_top"><code class="literal">InstrumentationLifecycleStrategy</code></a>.
The InstrumentationAgent is the object that interfaces with a
<a class="link" href="http://java.sun.com/j2se/1.5.0/docs/api/javax/management/MBeanServer.html" target="_top"><code class="literal">MBeanServer</code></a>
to register / unregister Camel MBeans. Multiple
CamelContexts / InstrumentationAgents can / should share a <code class="literal">MBeanServer</code>. By
default, Camel runtime picks the first <code class="literal">MBeanServer</code> returned by
<a class="link" href="http://java.sun.com/j2se/1.5.0/docs/api/javax/management/MBeanServerFactory.html#findMBeanServer(java.lang.String)" target="_top">MBeanServerFactory.findMBeanServer
method</a> that matches the default domain name of <code class="literal">org.apache.camel</code>.</p><p>You may want to change the default domain name to match the
<code class="literal">MBeanServer</code> instance that you are already using in your application.
Especially, if your <code class="literal">MBeanServer</code> is attached to a JMX connector server,
you will not need to create a connector server in Camel.</p><p>You can configure the matching default domain name via system property.</p><pre class="screen">-Dorg.apache.camel.jmx.mbeanServerDefaultDomain=&lt;your.domain.name&gt;</pre><p>Or, by adding a <code class="literal">jmxAgent</code> element inside the camelContext element in
Spring configuration:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jmxAgent</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"agent"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">mbeanServerDefaultDomain</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"your.domain.name"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    ...
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre><p>If no matching <code class="literal">MBeanServer</code> can be found, a new one is created and the
new `MBeanServer&#8217;s default domain name is set according to the default
and configuration as mentioned above.</p><p>It is also possible to use the
<a class="link" href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/management/ManagementFactory.html#getPlatformMBeanServer()" target="_top"><code class="literal">PlatformMBeanServer</code></a>
when it is desirable to manage JVM MBeans by setting the system
property. The <code class="literal">MBeanServer</code> default domain name configuration is ignored
as it is not applicable.</p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="imagesdb/caution.png"></td><th align="left">Caution</th></tr><tr><td align="left" valign="top"><p>Starting in next release (1.5), the default
value of <code class="literal">usePlatformMBeanServer</code> will be changed to <code class="literal">true</code>. You can set
the property to <code class="literal">false</code> to disable using platform <code class="literal">MBeanServer</code>.</p></td></tr></table></div><pre class="screen">-Dorg.apache.camel.jmx.usePlatformMBeanServer=True</pre><p>Or, by adding a <code class="literal">jmxAgent</code> element inside the <code class="literal">camelContext</code> element in
Spring configuration:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jmxAgent</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"agent"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">usePlatformMBeanServer</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    ...
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_creating_jmx_rmi_connector_server"></a>Creating JMX RMI Connector Server</h3></div></div></div><p>JMX connector server enables MBeans to be remotely managed by a JMX
client such as JConsole; Camel JMX RMI connector server can be
optionally turned on by setting system property and the <code class="literal">MBeanServer</code>
used by Camel is attached to that connector server.</p><pre class="screen">-Dorg.apache.camel.jmx.createRmiConnector=True</pre><p>Or, by adding a <code class="literal">jmxAgent</code> element inside the <code class="literal">camelContext</code> element in
Spring configuration:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jmxAgent</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"agent"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">createConnector</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    ...
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_jmx_service_url"></a>JMX Service URL</h3></div></div></div><p>The default JMX Service URL has the format:</p><pre class="screen">service:jmx:rmi:///jndi/rmi://localhost:&lt;registryPort&gt;/&lt;serviceUrlPath&gt;</pre><p><code class="literal">registryPort</code> is the RMI registry port and the default value is
<code class="literal">1099</code>.</p><p>You can set the RMI registry port by system property.</p><pre class="screen">-Dorg.apache.camel.jmx.rmiConnector.registryPort=&lt;port number&gt;</pre><p>Or, by adding a <code class="literal">jmxAgent</code> element inside the <code class="literal">camelContext</code> element in
Spring configuration:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jmxAgent</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"agent"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">createConnector</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">registryPort</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"port number"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    ...
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre><p><code class="literal">serviceUrlPath</code> is the path name in the URL and the default value is
<code class="literal">/jmxrmi/camel</code>.</p><p>You can set the service URL path by system property.</p><pre class="screen">-Dorg.apache.camel.jmx.serviceUrlPath=&lt;path&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="imagesdb/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>Setting ManagementAgent settings in Java</strong></span></p><p>In <span class="strong"><strong>Camel 2.4</strong></span> onwards you can also set the various options on the
<code class="literal">ManagementAgent</code>:</p><pre class="programlisting">context.getManagementStrategy().getManagementAgent().setServiceUrlPath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"/foo/bar"</em></strong>);
context.getManagementStrategy().getManagementAgent().setRegistryPort(<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">2113</span>);
context.getManagementStrategy().getManagementAgent().setCreateConnector(true);</pre></td></tr></table></div><p>Or, by adding a <code class="literal">jmxAgent</code> element inside the camelContext element in
Spring configuration:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jmxAgent</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"agent"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">createConnector</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">serviceUrlPath</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"path"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    ...
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre><p>By default, RMI server object listens on a dynamically generated port,
which can be a problem for connections established through a firewall.
In such situations, RMI connection port can be explicitly set by the
system property.</p><pre class="screen">-Dorg.apache.camel.jmx.rmiConnector.connectorPort=&lt;port number&gt;</pre><p>Or, by adding a <code class="literal">jmxAgent</code> element inside the <code class="literal">camelContext</code> element in
Spring configuration:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://activemq.apache.org/camel/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jmxAgent</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"agent"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">createConnector</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">connectorPort</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"port number"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    ...
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre><p>When the connector port option is set, the JMX service URL will become:</p><pre class="screen">service:jmx:rmi://localhost:&lt;connectorPort&gt;/jndi/rmi://localhost:&lt;registryPort&gt;/&lt;serviceUrlPath&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_the_system_properties_for_camel_jmx_support"></a>The System Properties for Camel JMX support</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="20%" class="col_1"><col width="20%" class="col_2"><col width="60%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Property Name</th><th align="left" valign="top">value</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">org.apache.camel.jmx</code></p></td><td align="left" valign="top"><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td align="left" valign="top"><p>if is <code class="literal">true</code>, it will enable jmx
feature in Camel</p></td></tr></tbody></table></div><p>See more system properties in this section below: <span class="emphasis"><em>jmxAgent Properties
Reference</em></span>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_how_to_use_authentication_with_jmx"></a>How to use authentication with JMX</h3></div></div></div><p>JMX in the JDK have features for authentication and also for using
secure connections over SSL. You have to refer to the SUN documentation
how to use this:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="http://java.sun.com/j2se/1.5.0/docs/guide/management/agent.html" target="_top">http://java.sun.com/j2se/1.5.0/docs/guide/management/agent.html</a></li><li class="listitem"><a class="link" href="http://java.sun.com/javase/6/docs/technotes/guides/management/agent.html" target="_top">http://java.sun.com/javase/6/docs/technotes/guides/management/agent.html</a></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_jmx_inside_an_application_server"></a>JMX inside an Application Server</h3></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="jmx-component.html#_tomcat_6">Tomcat 6</a></span></dt><dt><span class="section"><a href="jmx-component.html#_jboss_as_4">JBoss AS 4</a></span></dt><dt><span class="section"><a href="jmx-component.html#_websphere">WebSphere</a></span></dt><dt><span class="section"><a href="jmx-component.html#_oracle_oc4j">Oracle OC4j</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_tomcat_6"></a>Tomcat 6</h4></div></div></div><p>See <a class="link" href="http://tomcat.apache.org/tomcat-6.0-doc/monitoring.html" target="_top">this page</a>
for details about enabling JMX in Tomcat.</p><p>In short, modify your catalina.sh (or catalina.bat in Windows) file to
set the following options&#8230;&#8203;</p><pre class="screen"> set CATALINA_OPTS=-Dcom.sun.management.jmxremote \
    -Dcom.sun.management.jmxremote.port=1099 \
    -Dcom.sun.management.jmxremote.ssl=false \
    -Dcom.sun.management.jmxremote.authenticate=false</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_jboss_as_4"></a>JBoss AS 4</h4></div></div></div><p>By default JBoss creates its own <code class="literal">MBeanServer</code>. To allow Camel to expose
to the same server follow these steps:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Tell Camel to use the Platform <code class="literal">MBeanServer</code> (This defaults to true
in Camel 1.5)</li></ol></div><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camel:camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camelContext"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camel:jmxAgent</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"jmxAgent"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">mbeanObjectDomainName</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.yourname"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">usePlatformMBeanServer</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">  /&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camel:camelContext&gt;</strong></pre><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Alter your JBoss instance to use the Platform <code class="literal">MBeanServer</code>.
Add the following property to your <code class="literal">JAVA_OPTS</code> by editing <code class="literal">run.sh</code> or
<code class="literal">run.conf</code> <code class="literal">-Djboss.platform.mbeanserver</code>. See
<a class="link" href="http://wiki.jboss.org/wiki/JBossMBeansInJConsole" target="_top">http://wiki.jboss.org/wiki/JBossMBeansInJConsole</a></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_websphere"></a>WebSphere</h4></div></div></div><p>Alter the <code class="literal">mbeanServerDefaultDomain</code> to be <code class="literal">WebSphere</code>:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camel:jmxAgent</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"agent"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">createConnector</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">mbeanObjectDomainName</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.yourname"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">usePlatformMBeanServer</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"false"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">mbeanServerDefaultDomain</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"WebSphere"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_oracle_oc4j"></a>Oracle OC4j</h4></div></div></div><p>The Oracle OC4J J2EE application server will not allow Camel to access
the platform <code class="literal">MBeanServer</code>. You can identify this in the log as Camel
will log a <code class="literal">WARNING</code>.</p><pre class="screen">xxx xx, xxxx xx:xx:xx xx org.apache.camel.management.InstrumentationLifecycleStrategy onContextStart
WARNING: Could not register CamelContext MBean
java.lang.SecurityException: Unauthorized access from application: xx to MBean: java.lang:type=ClassLoading
        at oracle.oc4j.admin.jmx.shared.UserMBeanServer.checkRegisterAccess(UserMBeanServer.java:873)</pre><p>To resolve this you should disable the JMX agent in Camel, see section
<span class="emphasis"><em>Disabling JMX instrumentation agent in Camel</em></span>.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_advanced_jmx_configuration"></a>Advanced JMX Configuration</h3></div></div></div><p>The Spring configuration file allows you to configure how Camel is
exposed to JMX for management. In some cases, you could specify more
information here, like the connector&#8217;s port or the path name.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_example_9"></a>Example:</h3></div></div></div><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jmxAgent</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"agent"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">createConnector</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">registryPort</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"2000"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">mbeanServerDefaultDomain</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.test"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;route&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;from</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"seda:start"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
      <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;to</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">uri</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"mock:result"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/route&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre><p>If you wish to change the Java 5 JMX settings you can use various
<a class="link" href="http://java.sun.com/j2se/1.5.0/docs/guide/management/agent.html#properties" target="_top">JMX
system properties</a></p><p>For example you can enable remote JMX connections to the Sun JMX
connector, via setting the following environment variable (using <span class="strong"><strong>set</strong></span>
or <span class="strong"><strong>export</strong></span> depending on your platform). These settings only configure
the Sun JMX connector within Java 1.5+, not the JMX connector that Camel
creates by default.</p><pre class="screen">SUNJMX=-Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.port=1616 \
-Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false</pre><p>(The SUNJMX environment variable is simple used by the startup script
for Camel, as additional startup parameters for the JVM. If you start
Camel directly, you&#8217;ll have to pass these parameters yourself.)</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_literal_jmxagent_literal_properties_reference"></a><code class="literal">jmxAgent</code> Properties Reference</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="25%" class="col_1"><col width="25%" class="col_2"><col width="25%" class="col_3"><col width="25%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Spring property</th><th align="left" valign="top">System property</th><th align="left" valign="top">Default Value</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">id</code></p></td><td align="left" valign="top"><p>&nbsp;</p></td><td align="left" valign="top"><p>&nbsp;</p></td><td align="left" valign="top"><p>The JMX agent name, and it is not optional</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">usePlatformMBeanServer</code></p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.jmx.usePlatformMBeanServer</code></p></td><td align="left" valign="top"><p><code class="literal">false</code>, <code class="literal">true</code> - Release 1.5 or later</p></td><td align="left" valign="top"><p>If <code class="literal">true</code>, it will use the
<code class="literal">MBeanServer</code> from the JVM</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">mbeanServerDefaultDomain</code></p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.jmx.mbeanServerDefaultDomain</code></p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel</code></p></td><td align="left" valign="top"><p>The default JMX domain of the <code class="literal">MBeanServer</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">mbeanObjectDomainName</code></p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.jmx.mbeanObjectDomainName</code></p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel</code></p></td><td align="left" valign="top"><p>The JMX domain that all object names will use</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">createConnector</code></p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.jmx.createRmiConnect</code></p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p>If
we should create a JMX connector (to allow remote management) for the
<code class="literal">MBeanServer</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">registryPort</code></p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.jmx.rmiConnector.registryPort</code></p></td><td align="left" valign="top"><p><code class="literal">1099</code></p></td><td align="left" valign="top"><p>The port that the JMX RMI registry will use</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">connectorPort</code></p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.jmx.rmiConnector.connectorPort</code></p></td><td align="left" valign="top"><p>-1
(dynamic)</p></td><td align="left" valign="top"><p>The port that the JMX RMI server will use</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">serviceUrlPath</code></p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.jmx.serviceUrlPath</code></p></td><td align="left" valign="top"><p><code class="literal">/jmxrmi/camel</code></p></td><td align="left" valign="top"><p>The path that JMX connector will be registered under</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">onlyRegisterProcessorWithCustomId</code></p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.jmx.onlyRegisterProcessorWithCustomId</code></p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.0:</strong></span> If this option is enabled then only processors with a
custom id set will be registered. This allows you to filer out unwanted
processors in the JMX console.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">statisticsLevel</code></p></td><td align="left" valign="top"><p>&nbsp;</p></td><td align="left" valign="top"><p><code class="literal">All / Default</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.1:</strong></span> Configures the
level for whether performance statistics is enabled for the MBean. See
section <span class="emphasis"><em>Configuring level of granularity for performance statistics</em></span>
for more details. From <span class="strong"><strong>Camel 2.16</strong></span> onwards the All option is renamed to
Default, and a new Extended option has been introduced which allows
gathered additional runtime JMX metrics.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">includeHostName</code></p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.jmx.includeHostName</code></p></td><td align="left" valign="top"><p>&nbsp;</p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel
2.13:</strong></span> Whether to include the hostname in the MBean naming. From Camel
2.13 onwards this is default <code class="literal">false</code>, where as in older releases its
default <code class="literal">true</code>. You can use this option to restore old behavior if
really needed.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">useHostIPAddress</code></p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.jmx.useHostIPAddress</code></p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.16:</strong></span> Whether to use hostname or IP Address in the service url
when creating the remote connector. By default the hostname will be
used.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">loadStatisticsEnabled</code></p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.jmx.loadStatisticsEnabled</code></p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.16:</strong></span>Whether load statistics is enabled (gathers
load statistics using a background thread per CamelContext).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">endpointRuntimeStatisticsEnabled</code></p></td><td align="left" valign="top"><p><code class="literal">org.apache.camel.jmx.endpointRuntimeStatisticsEnabled</code></p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel
2.16:</strong></span> Whether endpoint runtime statistics is enabled (gathers runtime
usage of each incoming and outgoing endpoints).</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_configuring_whether_to_register_mbeans_always_for_new_routes_or_just_by_default"></a>Configuring whether to register MBeans always, for new routes or just by default</h3></div></div></div><p><span class="strong"><strong>Available as of Camel 2.7</strong></span></p><p>Camel now offers 2 settings to control whether or not to register mbeans</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="34%" class="col_1"><col width="33%" class="col_2"><col width="33%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Option</th><th align="left" valign="top">Default</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">registerAlways</code></p></td><td align="left" valign="top"><p><code class="literal">false</code></p></td><td align="left" valign="top"><p>If enabled then MBeans is always registered.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">registerNewRoutes</code></p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p>If enabled then adding new routes after
CamelContext has been started will also register
MBeans from that given route.</p></td></tr></tbody></table></div><p>By default Camel registers MBeans for all the routes configured when its
starting. The <code class="literal">registerNewRoutes</code> option control if MBeans should also
be registered if you add new routes thereafter. You can disable this, if
you for example add and remove temporary routes where management is not
needed.</p><p>Be a bit caution to use the <code class="literal">registerAlways</code> option when using dynamic
EIP patterns such as the
Recipient List having unique endpoints. If so
then each unique endpoint and its associated services/producers would
also be registered. This could potential lead to system degration due
the rising number of mbeans in the registry. A MBean is not a
light-weight object and thus consumes memory.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_monitoring_camel_using_jmx"></a>Monitoring Camel using JMX</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="jmx-component.html#_using_jconsole_to_monitor_camel">Using JConsole to monitor Camel</a></span></dt><dt><span class="section"><a href="jmx-component.html#_which_endpoints_are_registered">Which endpoints are registered</a></span></dt><dt><span class="section"><a href="jmx-component.html#_which_processors_are_registered">Which processors are registered</a></span></dt><dt><span class="section"><a href="jmx-component.html#_how_to_use_the_jmx_notificationlistener_to_listen_the_camel_events">How to use the JMX NotificationListener to listen the camel events?</a></span></dt><dt><span class="section"><a href="jmx-component.html#_using_the_tracer_mbean_to_get_fine_grained_tracing">Using the Tracer MBean to get fine grained tracing</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_using_jconsole_to_monitor_camel"></a>Using JConsole to monitor Camel</h3></div></div></div><p>The <code class="literal">CamelContext</code> should appear in the list of local connections, if
you are running JConsole on the same host as Camel.</p><p>To connect to a remote Camel instance, or if the local process does not
show up, use Remote Process option, and enter an URL. Here is an example
localhost <code class="literal">URL:service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi/camel</code>.</p><p>Using the Apache Camel with JConsole:</p><p><span class="inlinemediaobject"><img src="images/camel-jmx.png" alt="image"></span></p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_which_endpoints_are_registered"></a>Which endpoints are registered</h3></div></div></div><p>In <span class="strong"><strong>Camel 2.1</strong></span> onwards <span class="strong"><strong>only</strong></span> <code class="literal">singleton</code> endpoints are registered as
the overhead for non singleton will be substantial in cases where
thousands or millions of endpoints are used. This can happens when using
a Recipient List EIP or from a
<code class="literal">ProducerTemplate</code> that sends a lot of messages.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_which_processors_are_registered"></a>Which processors are registered</h3></div></div></div><p>See this FAQ.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_how_to_use_the_jmx_notificationlistener_to_listen_the_camel_events"></a>How to use the JMX NotificationListener to listen the camel events?</h3></div></div></div><p>The Camel notification events give a coarse grained overview what is
happening. You can see lifecycle event from context and endpoints and
you can see exchanges being received by and sent to endpoints.</p><p>From <span class="strong"><strong>Camel 2.4</strong></span> you can use a custom JMX NotificationListener to listen
the camel events.</p><p>First you need to set up a <code class="literal">JmxNotificationEventNotifier</code> before you start
the CamelContext:</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// Set up the JmxNotificationEventNotifier</em>
notifier = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> JmxNotificationEventNotifier();
notifier.setSource(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"MyCamel"</em></strong>);
notifier.setIgnoreCamelContextEvents(true);
notifier.setIgnoreRouteEvents(true);
notifier.setIgnoreServiceEvents(true);

CamelContext context = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> DefaultCamelContext(createRegistry());
context.getManagementStrategy().addEventNotifier(notifier);</pre><p>Second you can register your listener for listening the event:</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// register the NotificationListener</em>
ObjectName on = ObjectName.getInstance(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"org.apache.camel:context=camel-1,type=eventnotifiers,name=JmxEventNotifier"</em></strong>);
MyNotificationListener listener = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> MyNotificationListener();
context.getManagementStrategy().getManagementAgent().getMBeanServer().addNotificationListener(on,
    listener,
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> NotificationFilter() {
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">private</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">static</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">final</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">long</strong> serialVersionUID = <span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">1L</span>;

        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">boolean</strong> isNotificationEnabled(Notification notification) {
            <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</strong> notification.getSource().equals(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"MyCamel"</em></strong>);
        }
    }, null);</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_using_the_tracer_mbean_to_get_fine_grained_tracing"></a>Using the Tracer MBean to get fine grained tracing</h3></div></div></div><p>Additionally to the coarse grained notifications above <span class="strong"><strong>Camel 2.9.0</strong></span>
support JMX Notification for fine grained trace events.</p><p>These can be found in the Tracer MBean. To activate fine grained tracing
you first need to activate tracing on the context or on a route.</p><p>This can either be done when configuring the context or on the context /
route MBeans.</p><p>As a second step you have to set the <code class="literal">jmxTraceNotifications</code> attribute
to <code class="literal">true</code> on the tracer. This can again be done when configuring the
context or at runtime on the tracer MBean.</p><p>Now you can register for TraceEvent Notifications on the Tracer MBean
using JConsole. There will be one Notification for every step on the
route with all exchange and message details:</p><p><span class="inlinemediaobject"><img src="images/jconsole_trace_notifications.png" alt="image"></span></p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_jmx_for_your_own_camel_code"></a>Using JMX for your own Camel Code</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="jmx-component.html#_registering_your_own_managed_endpoints">Registering your own Managed Endpoints</a></span></dt><dt><span class="section"><a href="jmx-component.html#_programming_your_own_managed_services">Programming your own Managed Services</a></span></dt><dt><span class="section"><a href="jmx-component.html#_managementnamingstrategy">ManagementNamingStrategy</a></span></dt><dt><span class="section"><a href="jmx-component.html#_management_naming_pattern">Management naming pattern</a></span></dt><dt><span class="section"><a href="jmx-component.html#_managementstrategy">ManagementStrategy</a></span></dt><dt><span class="section"><a href="jmx-component.html#_configuring_level_of_granularity_for_performance_statistics">Configuring level of granularity for performance statistics</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_registering_your_own_managed_endpoints"></a>Registering your own Managed Endpoints</h3></div></div></div><p><span class="strong"><strong>Available as of Camel 2.0</strong></span>
You can decorate your own endpoints with Spring managed annotations
<code class="literal">@ManagedResource</code> to allow to register them in the Camel <code class="literal">MBeanServer</code>
and thus access your custom MBeans using JMX.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In <span class="strong"><strong>Camel 2.1</strong></span> we have changed this to apply other than just
endpoints but then you need to implement the interface
<code class="literal">org.apache.camel.spi.ManagementAware</code> as well. More about this later.</p></td></tr></table></div><p>For example we have the following custom endpoint where we define some
options to be managed:</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@ManagedResource(description = "Our custom managed endpoint")</span></em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong> CustomEndpoint <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">extends</strong> MockEndpoint <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">implements</strong> ManagementAware&lt;CustomEndpoint&gt; {

    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> CustomEndpoint(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">final</strong> String endpointUri, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">final</strong> Component component) {
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">super</strong>(endpointUri, component);
    }

    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> Object getManagedObject(CustomEndpoint object) {
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">this</strong>;
    }

    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">boolean</strong> isSingleton() {
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</strong> true;
    }

    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">protected</strong> String createEndpointUri() {
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"custom"</em></strong>;
    }

    <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@ManagedAttribute</span></em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> String getFoo() {
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"bar"</em></strong>;
    }

    <em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@ManagedAttribute</span></em>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</strong> String getEndpointUri() {
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">super</strong>.getEndpointUri();
    }
}</pre><p>Notice from <span class="strong"><strong>Camel 2.9</strong></span> onwards its encouraged to use the
<code class="literal">@ManagedResource</code>, <code class="literal">@ManagedAttribute</code>, and <code class="literal">@ManagedOperation</code> from
the <code class="literal">org.apache.camel.api.management</code> package. This allows your custom
code to not depend on Spring JARs.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_programming_your_own_managed_services"></a>Programming your own Managed Services</h3></div></div></div><p><span class="strong"><strong>Available as of Camel 2.1</strong></span></p><p>Camel now offers to use your own MBeans when registering services for
management. What that means is for example you can develop a custom
Camel component and have it expose MBeans for endpoints, consumers and
producers etc. All you need to do is to implement the interface
<code class="literal">org.apache.camel.spi.ManagementAware</code> and return the managed object
Camel should use.</p><p>Now before you think oh boys the JMX API is really painful and terrible,
then yeah you are right. Lucky for us Spring though too and they created
a range of annotations you can use to export management on an existing
bean. That means that you often use that and just return <code class="literal">this</code> in the
<code class="literal">getManagedObject</code> from the <code class="literal">ManagementAware</code> interface. For an example
see the code example above with the <code class="literal">CustomEndpoint</code>.</p><p>Now in <span class="strong"><strong>Camel 2.1</strong></span> you can do this for all the objects that Camel
registers for management which are quite a bunch, but not all.</p><p>For services which do not implement this <code class="literal">ManagementAware</code> interface
then Camel will fallback to using default wrappers as defined in the
table below:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="33%" class="col_1"><col width="67%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Type</th><th align="left" valign="top">MBean wrapper</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">CamelContext</code></p></td><td align="left" valign="top"><p><code class="literal">ManagedCamelContext</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Component</code></p></td><td align="left" valign="top"><p><code class="literal">ManagedComponent</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Endpoint</code></p></td><td align="left" valign="top"><p><code class="literal">ManagedEndpoint</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Consumer</code></p></td><td align="left" valign="top"><p><code class="literal">ManagedConsumer</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Producer</code></p></td><td align="left" valign="top"><p><code class="literal">ManagedProducer</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Route</code></p></td><td align="left" valign="top"><p><code class="literal">ManagedRoute</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Processor</code></p></td><td align="left" valign="top"><p><code class="literal">ManagedProcessor</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Tracer</code></p></td><td align="left" valign="top"><p><code class="literal">ManagedTracer</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Service</code></p></td><td align="left" valign="top"><p><code class="literal">ManagedService</code></p></td></tr></tbody></table></div><p>In addition to that there are some extended wrappers for specialized
types such as:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="33%" class="col_1"><col width="67%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Type</th><th align="left" valign="top">MBean wrapper</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">ScheduledPollConsumer</code></p></td><td align="left" valign="top"><p><code class="literal">ManagedScheduledPollConsumer</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">BrowsableEndpoint</code></p></td><td align="left" valign="top"><p><code class="literal">ManagedBrowseableEndpoint</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Throttler</code></p></td><td align="left" valign="top"><p><code class="literal">ManagedThrottler</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">Delayer</code></p></td><td align="left" valign="top"><p><code class="literal">ManagedDelayer</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">SendProcessor</code></p></td><td align="left" valign="top"><p><code class="literal">ManagedSendProcessor</code></p></td></tr></tbody></table></div><p>And in the future we will add additional wrappers for more EIP patterns.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_managementnamingstrategy"></a>ManagementNamingStrategy</h3></div></div></div><p><span class="strong"><strong>Available as of Camel 2.1</strong></span></p><p>Camel provides a pluggable API for naming strategy by
<code class="literal">org.apache.camel.spi.ManagementNamingStrategy</code>. A default
implementation is used to compute the MBean names that all MBeans are
registered with.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_management_naming_pattern"></a>Management naming pattern</h3></div></div></div><p><span class="strong"><strong>Available as of Camel 2.10</strong></span></p><p>From <span class="strong"><strong>Camel 2.10</strong></span> onwards we made it easier to configure a naming
pattern for the MBeans. The pattern is used as part of the <code class="literal">ObjectName</code>
as they key after the domain name.</p><p>By default Camel will use MBean names for the <code class="literal">ManagedCamelContextMBean</code>
as follows:</p><pre class="screen">org.apache.camel:context=localhost/camel-1,type=context,name=camel-1</pre><p>And from <span class="strong"><strong>Camel 2.13</strong></span> onwards the hostname is not included in the MBean
names, so the above example would be as follows:</p><pre class="screen">org.apache.camel:context=camel-1,type=context,name=camel-1</pre><p>If you configure a name on the <code class="literal">CamelContext</code> then that name is part of
the <code class="literal">ObjectName</code> as well. For example if we have</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"myCamel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">...&gt;</span></pre><p>Then the MBean names will be as follows:</p><pre class="screen">org.apache.camel:context=localhost/myCamel,type=context,name=myCamel</pre><p>Now if there is a naming clash in the JVM, such as there already exists
a MBean with that given name above, then Camel will by default try to
auto correct this by finding a new free name in the <code class="literal">JMXMBeanServer</code> by
using a counter. As shown below the counter is now appended, so we have
<code class="literal">myCamel-1</code> as part of the <code class="literal">ObjectName</code>:</p><pre class="screen">org.apache.camel:context=localhost/myCamel-1,type=context,name=myCamel</pre><p>This is possible because Camel uses a naming pattern by default that
supports the following tokens:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal"><span class="marked">camelId</span></code> = the CamelContext id (eg the name)</li><li class="listitem"><code class="literal"><span class="marked">name</span></code> - same as <code class="literal"><span class="marked">camelId</span></code></li><li class="listitem"><code class="literal"><span class="marked">counter</span></code> - an incrementing counter
<code class="literal">* <span class="marked">bundleId</span></code> - the OSGi bundle id (only for OSGi environments)</li><li class="listitem"><code class="literal"><span class="marked">symbolicName</span></code> - the OSGi symbolic name (only for OSGi environments)</li><li class="listitem"><code class="literal"><span class="marked">version</span></code> - the OSGi bundle version (only for OSGi environments)</li></ul></div><p>The default naming pattern is differentiated between OSGi and non-OSGi
as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">non OSGI: <code class="literal"><span class="marked">name</span></code></li><li class="listitem">OSGi: <code class="literal"><span class="marked">bundleId</span>-<span class="marked">name</span></code></li><li class="listitem">OSGi <span class="strong"><strong>Camel 2.13:</strong></span> <code class="literal"><span class="marked">symbolicName</span></code></li></ul></div><p>However if there is a naming clash in the <code class="literal">JMXMBeanServer</code> then Camel
will automatic fallback and use the <code class="literal"><span class="marked">counter</span></code> in the pattern to remedy
this. And thus the following patterns will then be used:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">non OSGI: <code class="literal"><span class="marked">name</span>-<span class="marked">counter</span></code></li><li class="listitem">OSGi: <code class="literal"><span class="marked">bundleId</span>-<span class="marked">name</span>-<span class="marked">counter</span></code></li><li class="listitem">OSGi <span class="strong"><strong>Camel 2.13:</strong></span> <code class="literal"><span class="marked">symbolicName</span>-<span class="marked">counter</span></code></li></ul></div><p>If you set an explicit naming pattern, then that pattern is always used,
and the default patterns above is <span class="strong"><strong>not</strong></span> used.</p><p>This allows us to have full control, very easily, of the naming for both
the <code class="literal">CamelContext</code> id in the Registry as well the
JMX MBeans in the <code class="literal">JMXMBeanRegistry</code>.</p><p>From&nbsp;<span class="strong"><strong>Camel 2.15</strong></span> onwards you can configure the default management
name pattern using a JVM system property, to configure this globally for
the JVM. Notice that you can override this pattern by configure it
explicit, as shown in the examples further below.</p><p>Set a JVM system property to use a default management name pattern that
prefixes the name with cool.</p><pre class="programlisting">System.setProperty(JmxSystemPropertyKeys.MANAGEMENT_NAME_PATTERN, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"cool-#name#"</em></strong>);</pre><p>So if we want to explicit name both the <code class="literal">CamelContext</code> and to use fixed
MBean names, that do not change (eg has no counters), then we can use
the new <code class="literal">managementNamePattern</code> attribute:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"myCamel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">managementNamePattern</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"#name#"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong></pre><p>Then the MBean names will always be as follows:</p><pre class="screen">org.apache.camel:context=localhost/myCamel,type=context,name=myCamel</pre><p>In Java, you can configure the <code class="literal">managementNamePattern</code> as follows:</p><pre class="programlisting">context.getManagementNameStrategy().setNamePattern(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"#name#"</em></strong>);</pre><p>You can also use a different name in the <code class="literal">managementNamePattern</code> than
the id, so for example we can do:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"myCamel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">managementNamePattern</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"coolCamel"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong></pre><p>You may want to do this in OSGi environments in case you do not want the
OSGi bundle id as part of the MBean names. As the OSGi bundle id can
change if you restart the server, or uninstall and install the same
application. You can then do as follows to not use the OSGi bundle id as
part of the name:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"myCamel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">managementNamePattern</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"#name#"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong></pre><p>Note this requires that <code class="literal">myCamel</code> is unique in the entire JVM. If you
install a 2nd Camel application that has the same <code class="literal">CamelContext</code> id and
<code class="literal">managementNamePattern</code> then Camel will fail upon starting, and report a
MBean already exists exception.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_managementstrategy"></a>ManagementStrategy</h3></div></div></div><p><span class="strong"><strong>Available as of Camel 2.1</strong></span></p><p>Camel now provides a totally pluggable management strategy that allows
you to be 100% in control of management. It is a rich interface with
many methods for management. Not only for adding and removing managed
objects from the <code class="literal">MBeanServer</code>, but also event notification is provided
as well using the <code class="literal">org.apache.camel.spi.EventNotifier</code> API. What it
does, for example, is make it easier to provide an adapter for other
management products. In addition, it also allows you to provide more
details and features that are provided out of the box at Apache.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_configuring_level_of_granularity_for_performance_statistics"></a>Configuring level of granularity for performance statistics</h3></div></div></div><p><span class="strong"><strong>Available as of Camel 2.1</strong></span></p><p>You can now set a pre set level whether performance statistics is
enabled or not when Camel start ups. The levels are</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><code class="literal">Extended</code>&nbsp;- As default but with additional statistics gathered during
runtime such as fine grained level of usage of endpoints and more. This
options requires&nbsp;Camel 2.16</li><li class="listitem"><code class="literal">All</code> / <code class="literal">Default</code>&nbsp;- Camel will enable statistics for both routes and
processors (fine grained). From&nbsp;<span class="strong"><strong>Camel 2.16</strong></span> onwards the All option
was renamed to Default.</li><li class="listitem"><code class="literal">RoutesOnly</code> - Camel will only enable statistics for routes (coarse
grained)</li><li class="listitem"><code class="literal">Off</code> - Camel will not enable statistics for any.</li></ul></div><p>From <span class="strong"><strong>Camel 2.9</strong></span> onwards the performance statistics also include average
load statistics per CamelContext and Route MBeans. The statistics is
average load based on the number of in-flight exchanges, on a per 1, 5,
and 15 minute rate. This is similar to load statistics on Unix systems.
<span class="strong"><strong>Camel 2.11</strong></span> onwards allows you to explicit disable load performance
statistics by setting <code class="literal">loadStatisticsEnabled=false</code> on the <code class="literal">&lt;jmxAgent&gt;</code>.
Note that it will be off if the statics level is configured to off as
well. From <span class="strong"><strong>Camel 2.13</strong></span> onwards the load performance statistics is by
default disabled. You can enable this by
setting&nbsp;<code class="literal">loadStatisticsEnabled=true</code>&nbsp;on the <code class="literal">&lt;jmxAgent&gt;</code>.</p><p>At runtime you can always use the management console (such as JConsole)
to change on a given route or processor whether its statistics are
enabled or not.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>What does statistics enabled mean?</strong></span></p><p>Statistics enabled means that Camel will do fine grained performance
statistics for that particular MBean. The statistics you can see are
many, such as: number of exchanges completed/failed,
last/total/mina/max/mean processing time, first/last failed time, etc.</p></td></tr></table></div><p>Using Java DSL you set this level by:</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// only enable routes when Camel starts</em>
context.getManagementStrategy().setStatisticsLevel(ManagementStatisticsLevel.RoutesOnly);</pre><p>And from Spring DSL you do:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jmxAgent</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"agent"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">statisticsLevel</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"RoutesOnly"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
 ...
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_hiding_sensitive_information"></a>Hiding sensitive information</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="jmx-component.html#_declaring_which_jmx_attributes_and_operations_to_mask">Declaring which JMX attributes and operations to mask</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel 2.12</strong></span></p><p>By default, Camel enlists MBeans in JMX such as endpoints configured
using URIs. In this configuration, there may be
sensitive information such as passwords.</p><p>This information can be hidden by enabling the <code class="literal">mask</code> option as shown
below:</p><p>Using Java DSL you turn this on by:</p><pre class="programlisting">  <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// only enable routes when Camel starts</em>
  context.getManagementStrategy().getManagementAgent().setMask(true);</pre><p>And from Spring DSL you do:</p><pre class="programlisting">    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
        <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jmxAgent</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"agent"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">mask</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
     ...
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong></pre><p>This will mask URIs having options such as password and
passphrase, and use <code class="literal">xxxxxx</code> as the replacement value.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_declaring_which_jmx_attributes_and_operations_to_mask"></a>Declaring which JMX attributes and operations to mask</h3></div></div></div><p>On the <code class="literal">org.apache.camel.api.management.ManagedAttribute</code> and
<code class="literal">org.apache.camel.api.management.ManagedOperation</code>, the attribute <code class="literal">mask</code>
can be set to <code class="literal">true</code> to indicate that the result of this JMX
attribute/operation should be masked (if enabled on JMX agent, see
above).</p><p>For example, on the default managed endpoints from camel-core
<code class="literal">org.apache.camel.api.management.mbean.ManagedEndpointMBean</code>, we have
declared that the <code class="literal">EndpointUri</code> JMX attribute is masked:</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml"><span class="hl-annotation" style="color: gray">@ManagedAttribute(description = "Endpoint URI", mask = true)</span></em>
String getEndpointUri();</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_see_also_65"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Management Example</li><li class="listitem"><a class="link" href="why-is-my-processor-not-showing-up-in-jconsole.html" target="_top">Why is my
processor not showing up in JConsole</a></li></ul></div></div></div></body></html>