<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Master Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="mail-component.html" title="Mail Component"><link rel="next" href="metrics-component.html" title="Metrics Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="master-component"></a>Master Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="master-component.html#_using_the_master_endpoint">Using the master endpoint</a></span></dt><dt><span class="section"><a href="master-component.html#_uri_format_121">URI format</a></span></dt><dt><span class="section"><a href="master-component.html#_options_93">Options</a></span></dt><dt><span class="section"><a href="master-component.html#_example_13">Example</a></span></dt><dt><span class="section"><a href="master-component.html#_implementations">Implementations</a></span></dt><dt><span class="section"><a href="master-component.html#_see_also_75">See Also</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.20</strong></span></p><p>The <span class="strong"><strong>camel-master:</strong></span> endpoint provides a way to ensure only a single consumer in a cluster consumes from a given endpoint;
with automatic failover if that JVM dies.</p><p>This can be very useful if you need to consume from some legacy back end which either doesn&#8217;t support concurrent
consumption or due to commercial or stability reasons you can only have a single connection at any point in time.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_the_master_endpoint"></a>Using the master endpoint</h2></div></div></div><p>Just prefix any camel endpoint with <span class="strong"><strong>master:someName:</strong></span> where <span class="emphasis"><em>someName</em></span> is a logical name and is
used to acquire the master lock. e.g.</p><pre class="screen">from("master:cheese:jms:foo").to("activemq:wine");</pre><p>The above simulates the [Exclusive Consumers](<a class="link" href="http://activemq.apache.org/exclusive-consumer.html" target="_top">http://activemq.apache.org/exclusive-consumer.html</a>) type feature in
ActiveMQ; but on any third party JMS provider which maybe doesn&#8217;t support exclusive consumers.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_121"></a>URI format</h2></div></div></div><pre class="screen">master:namespace:endpoint[?options]</pre><p>Where endpoint is any Camel endpoint you want to run in master/slave mode.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_93"></a>Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="master-component.html#_path_parameters_2_parameters_32">Path Parameters (2 parameters):</a></span></dt><dt><span class="section"><a href="master-component.html#_query_parameters_4_parameters_4">Query Parameters (4 parameters):</a></span></dt></dl></div><p>The Master component supports 3 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>service</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Inject the service to use.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>CamelClusterService</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>serviceSelector</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Inject the service selector used to lookup the CamelClusterService to use.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Selector</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resolveProperty Placeholders</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether the component should resolve property placeholders on itself when starting. Only properties which are of String type can use property placeholders.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div><p>The Master endpoint is configured using URI syntax:</p><pre class="screen">master:namespace:delegateUri</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_2_parameters_32"></a>Path Parameters (2 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>namespace</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The name of the cluster namespace to use</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>delegateUri</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The endpoint uri to use in master/slave mode</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_4_parameters_4"></a>Query Parameters (4 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_example_13"></a>Example</h2></div></div></div><p>You can protect a clustered Camel application to only consume files from one active node.</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// the file endpoint we want to consume from</em>
String url = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:target/inbox?delete=true"</em></strong>;

<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// use the camel master component in the clustered group named myGroup</em>
<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// to run a master/slave mode in the following Camel url</em>
from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"master:myGroup:"</em></strong> + url)
    .log(name + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">" - Received file: ${file:name}"</em></strong>)
    .delay(delay)
    .log(name + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">" - Done file:     ${file:name}"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:target/outbox"</em></strong>);</pre><p>The master component leverages CamelClusterService you can configure using</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p class="simpara"><span class="strong"><strong>Java</strong></span></p><pre class="programlisting">ZooKeeperClusterService service = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> ZooKeeperClusterService();
service.setId(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"camel-node-1"</em></strong>);
service.setNodes(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"myzk:2181"</em></strong>);
service.setBasePath(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"/camel/cluster"</em></strong>);

context.addService(service)</pre></li><li class="listitem"><p class="simpara"><span class="strong"><strong>Xml (Spring/Blueprint)</strong></span></p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;beans</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://www.springframework.org/schema/beans"</span>
   <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns:xsi</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://www.w3.org/2001/XMLSchema-instance"</span>
   <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"
     http://www.springframework.org/schema/beans
     http://www.springframework.org/schema/beans/spring-beans.xsd
     http://camel.apache.org/schema/spring
     http://camel.apache.org/schema/spring/camel-spring.xsd"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>


  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"cluster"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.component.zookeeper.cluster.ZooKeeperClusterService"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"id"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"camel-node-1"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"basePath"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"/camel/cluster"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"nodes"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"myzk:2181"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong>

  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;camelContext</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">xmlns</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"http://camel.apache.org/schema/spring"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">autoStartup</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"false"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
    ...
  <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/camelContext&gt;</strong>

<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/beans&gt;</strong></pre></li><li class="listitem"><p class="simpara"><span class="strong"><strong>Spring boot</strong></span></p><pre class="programlisting">camel.component.zookeeper.cluster.service.enabled   = true
camel.component.zookeeper.cluster.service.id        = camel-node-1
camel.component.zookeeper.cluster.service.base-path = /camel/cluster
camel.component.zookeeper.cluster.service.nodes     = myzk:2181</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_implementations"></a>Implementations</h2></div></div></div><p>Camel provide the following ClusterService implementations:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">camel-atomix</li><li class="listitem">camel-consul</li><li class="listitem">camel-file</li><li class="listitem">camel-kubernetes</li><li class="listitem">camel-zookeeper</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_see_also_75"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Configuring Camel</li><li class="listitem">Component</li><li class="listitem">Endpoint</li><li class="listitem">Getting Started</li></ul></div></div></div></body></html>