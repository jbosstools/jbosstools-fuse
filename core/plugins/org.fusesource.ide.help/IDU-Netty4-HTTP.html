<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Netty4-HTTP</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-Components.html" title="Apache Camel Component Reference"><link rel="prev" href="IDU-NettyHTTP.html" title="Netty HTTP"><link rel="next" href="IDU-Olingo2.html" title="Olingo2"><link rel="copyright" href="tmdisclaim.html" title="Trademark Disclaimer"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="IDU-Netty4-HTTP"></a>Netty4-HTTP</h1></div></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-Netty4-HTTP_HSH_Netty4HTTPComponent"></a>Netty4 HTTP Component</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.14</strong></span></p><p>The <span class="strong"><strong>netty4-http</strong></span> component is an extension to <a href="IDU-Netty4.html" class="olink">Netty4</a> component to facilitiate HTTP transport with
            Netty4.</p><p>This camel component supports both producer and consumer endpoints.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important: Stream"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="imagesdb/important.png"></td><th align="left">Stream</th></tr><tr><td align="left" valign="top"><p>Netty is stream based, which means the input it receives is submitted to Camel as
                a stream. That means you will only be able to read the content of the stream
                    <span class="strong"><strong>once</strong></span>. If you find a situation where the
                message body appears to be empty or you need to access the data multiple times (eg:
                doing multicasting, or redelivery error handling) you should use <a class="link" href="http://camel.apache.org/maven/current/camel-core/apidocs/org/apache/camel/StreamCache.html" target="_top">Stream
                    caching</a> or convert the message body to a <code class="code">String</code> which is
                safe to be re-read multiple times.</p></td></tr></table></div><p>Maven users will need to add the following dependency to their <code class="code">pom.xml</code>
            for this component:</p><div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;artifactId&gt;camel-netty4-http&lt;/artifactId&gt;
    &lt;version&gt;x.x.x&lt;/version&gt;
    &lt;!-- use the same version as your Camel core version --&gt;
&lt;/dependency&gt;</pre></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scroll-bookmark-362"></a>URI format</h2></div></div></div><p>The URI scheme for a netty component is as follows</p><div class="informalexample"><pre class="programlisting">netty4-http:http://localhost:8080[?options]</pre></div><p>You can append query options to the URI in the following format,
                <code class="code">?option=value&amp;option=value&amp;...</code></p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important: Query parameters vs endpoint options"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="imagesdb/important.png"></td><th align="left">Query parameters vs endpoint options</th></tr><tr><td align="left" valign="top"><p>You may be wondering how Camel recognizes URI query parameters and endpoint
                options. For example you might create endpoint URI as follows -
                    <code class="code">netty4-http:http//example.com?myParam=myValue&amp;compression=true</code>
                . In this example <code class="code">myParam</code> is the HTTP parameter, while
                    <code class="code">compression</code> is the Camel endpoint option. The strategy used by
                Camel in such situations is to resolve available endpoint options and remove them
                from the URI. It means that for the discussed example, the HTTP request sent by
                Netty HTTP producer to the endpoint will look as follows -
                    <code class="code">http//example.com?myParam=myValue</code> , because
                    <code class="code">compression</code> endpoint option will be resolved and removed from the
                target URL.</p><p>Keep also in mind that you cannot specify endpoint options using dynamic headers
                (like <code class="code">CamelHttpQuery</code>). Endpoint options can be specified only at the
                endpoint URI definition level (like <code class="code">to</code> or <code class="code">from</code> DSL
                elements).</p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scroll-bookmark-363"></a>HTTP Options</h2></div></div></div><p></p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important: A lot more options"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="imagesdb/important.png"></td><th align="left">A lot more options</th></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>Important:</strong></span> This component inherits all the
                options from <a href="IDU-Netty4.html" class="olink">Netty4</a>. So make sure to look at
                the <a href="IDU-Netty4.html" class="olink">Netty4</a> documentation as well. Notice that
                some options from Netty4 are not applicable when using this Netty4 HTTP component,
                such as options related to UDP transport.</p></td></tr></table></div><table class="confluenceTable" id="d0e137928"><tbody><tr>
                    <th class="confluenceTh"><p>Name</p></th>
                    <th class="confluenceTh"><p>Default Value</p></th>
                    <th class="confluenceTh"><p>Description</p></th>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">chunkedMaxContentLength</code></p></td>
                    <td class="confluenceTd"><p><code class="code">1mb</code></p></td>
                    <td class="confluenceTd"><p>Value in bytes the max content length per chunked
                            frame received on the Netty HTTP server.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">compression</code></p></td>
                    <td class="confluenceTd"><p><code class="code">false</code></p></td>
                    <td class="confluenceTd"><p>Allow using gzip/deflate for compression on the
                            Netty HTTP server if the client supports it from the HTTP
                            headers.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">headerFilterStrategy</code></p></td>
                    <td class="confluenceTd"><p> </p></td>
                    <td class="confluenceTd"><p>To use a custom
                                <code class="code">org.apache.camel.spi.HeaderFilterStrategy</code> to filter
                            headers.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">httpMethodRestrict</code></p></td>
                    <td class="confluenceTd"><p> </p></td>
                    <td class="confluenceTd"><p>To disable HTTP methods on the Netty HTTP
                            consumer. You can specify multiple separated by comma.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">mapHeaders</code></p></td>
                    <td class="confluenceTd"><p><code class="code">true</code></p></td>
                    <td class="confluenceTd"><p>If this option is enabled, then during binding
                            from Netty to Camel <a class="link" href="http://camel.apache.org/message.html" target="_top">Message</a> then the headers will be mapped as well (eg added as
                            header to the Camel <a class="link" href="http://camel.apache.org/message.html" target="_top">Message</a> as well). You can turn off this option to disable
                            this. The headers can still be accessed from the
                                <code class="code">org.apache.camel.component.netty4.http.NettyHttpMessage</code>
                            message with the method <code class="code">getHttpRequest()</code> that returns the
                            Netty HTTP request <code class="code">io.netty.handler.codec.http.HttpRequest</code>
                            instance.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">matchOnUriPrefix</code></p></td>
                    <td class="confluenceTd"><p><code class="code">false</code></p></td>
                    <td class="confluenceTd"><p>Whether or not Camel should try to find a target
                            consumer by matching the URI prefix if no exact match is found. See
                            further below for more details.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">nettyHttpBinding</code></p></td>
                    <td class="confluenceTd"><p> </p></td>
                    <td class="confluenceTd"><p>To use a custom
                                <code class="code">org.apache.camel.component.netty4.http.NettyHttpBinding</code>
                            for binding to/from Netty and Camel Message API.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">bridgeEndpoint</code></p></td>
                    <td class="confluenceTd"><p><code class="code">false</code></p></td>
                    <td class="confluenceTd"><p>If the option is <code class="code">true</code>, the producer
                            will ignore the <code class="code">Exchange.HTTP_URI</code> header, and use the
                            endpoint's URI for request. You may also set the
                                <code class="code">throwExceptionOnFailure</code> to be <code class="code">false</code> to let
                            the producer send all the fault response back.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">throwExceptionOnFailure</code></p></td>
                    <td class="confluenceTd"><p><code class="code">true</code></p></td>
                    <td class="confluenceTd"><p>Option to disable throwing the
                                <code class="code">HttpOperationFailedException</code> in case of failed
                            responses from the remote server. This allows you to get all responses
                            regardles of the HTTP status code.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">traceEnabled</code></p></td>
                    <td class="confluenceTd"><p><code class="code">false</code></p></td>
                    <td class="confluenceTd"><p>Specifies whether to enable HTTP TRACE for this
                            Netty HTTP consumer. By default TRACE is turned off.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">transferException</code></p></td>
                    <td class="confluenceTd"><p><code class="code">false</code></p></td>
                    <td class="confluenceTd"><p>If enabled and an <a class="link" href="http://camel.apache.org/exchange.html" target="_top">Exchange</a> failed
                            processing on the consumer side, and if the caused Exception was send
                            back serialized in the response as a
                                <code class="code">application/x-java-serialized-object</code> content type. On
                            the producer side the exception will be deserialized and thrown as is,
                            instead of the <code class="code">HttpOperationFailedException</code>. The caused
                            exception is required to be serialized.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">urlDecodeHeaders</code></p></td>
                    <td class="confluenceTd"><p> </p></td>
                    <td class="confluenceTd"><p>If this option is enabled, then during binding
                            from Netty to Camel <a class="link" href="http://camel.apache.org/message.html" target="_top">Message</a> then the header values will be URL decoded (eg %20
                            will be a space character. Notice this option is used by the default
                                <code class="code">org.apache.camel.component.netty4.http.NettyHttpBinding</code>
                            and therefore if you implement a custom
                                <code class="code">org.apache.camel.component.netty4.http.NettyHttpBinding</code>
                            then you would need to decode the headers accordingly to this option.
                                <span class="emphasis"><em>Notice:</em></span> This option is default
                                <code class="code">false</code>.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">nettySharedHttpServer</code></p></td>
                    <td class="confluenceTd"><p><code class="code">null</code></p></td>
                    <td class="confluenceTd"><p>To use a shared Netty4 HTTP server. See <a class="link" href="http://camel.apache.org/netty-http-server-example.html" target="_top">Netty
                                HTTP Server Example</a> for more details.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">disableStreamCache</code></p></td>
                    <td class="confluenceTd"><p><code class="code">false</code></p></td>
                    <td class="confluenceTd"><p>Determines whether or not the raw input stream
                            from Netty <code class="code">HttpRequest#getContent()</code> is cached or not (Camel
                            will read the stream into a in light-weight memory based Stream caching)
                            cache. By default Camel will cache the Netty input stream to support
                            reading it multiple times to ensure it Camel can retrieve all data from
                            the stream. However you can set this option to <code class="code">true</code> when
                            you for example need to access the raw stream, such as streaming it
                            directly to a file or other persistent store. Mind that if you enable
                            this option, then you cannot read the Netty stream multiple times out of
                            the box, and you would need manually to reset the reader index on the
                            Netty raw stream.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">securityConfiguration</code></p></td>
                    <td class="confluenceTd"><p><code class="code">null</code></p></td>
                    <td class="confluenceTd"><p><span class="emphasis"><em>Consumer only</em></span>. Refers to a
                                <code class="code">org.apache.camel.component.netty4.http.NettyHttpSecurityConfiguration</code>
                            for configuring secure web resources.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">send503whenSuspended</code></p></td>
                    <td class="confluenceTd"><p><code class="code">true</code></p></td>
                    <td class="confluenceTd"><p><span class="emphasis"><em>Consumer only</em></span>. Whether to
                            send back HTTP status code 503 when the consumer has been suspended. If
                            the option is <code class="code">false</code> then the Netty Acceptor is unbound when
                            the consumer is suspended, so clients cannot connect
                        anymore.</p></td>
                </tr><tr>
                    <td><code class="literal">maxHeaderSize</code>
                    </td>
                    <td><code class="literal">8192</code>
                    </td>
                    <td><span class="bold"><strong>Camel 2.15.3:</strong></span>
                        <span class="bold"><strong>Consumer only</strong></span>. The maximum length of all
                        headers. If the sum of the length of each header exceeds this value, a
                            <code class="code">TooLongFrameException</code> will be raised.</td>
                </tr><tr>
                    <td><code class="literal">okStatusCodeRange</code>
                    </td>
                    <td><code class="literal">200-299</code>
                    </td>
                    <td><span class="bold"><strong>Camel 2.16:</strong></span> The status codes which is
                        considered a success response. The values are inclusive. The range must be
                        defined using the syntax,
                                <code class="code"><em class="replaceable"><code>from</code></em>-<em class="replaceable"><code>to</code></em></code>.</td>
                </tr><tr>
                    <td><code class="literal">useRelativePath</code>
                    </td>
                    <td><code class="literal">false</code>
                    </td>
                    <td><span class="bold"><strong>Camel 2.16:</strong></span>
                        <span class="bold"><strong>Producer only</strong></span>. Whether to use a path
                            (<code class="code">/myapp</code>) in the request line or an absolute URI
                            (<code class="code">http://0.0.0.0:8080/myapp</code>), which is the default.</td>
                </tr></tbody></table><p>The <code class="code">NettyHttpSecurityConfiguration</code> has the following options:</p><table class="confluenceTable" id="d0e138353"><tbody><tr>
                    <th class="confluenceTh"><p>Name</p></th>
                    <th class="confluenceTh"><p>Default Value</p></th>
                    <th class="confluenceTh"><p>Description</p></th>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">authenticate</code></p></td>
                    <td class="confluenceTd"><p><code class="code">true</code></p></td>
                    <td class="confluenceTd"><p>Whether authentication is enabled. Can be used to
                            quickly turn this off.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">constraint</code></p></td>
                    <td class="confluenceTd"><p><code class="code">Basic</code></p></td>
                    <td class="confluenceTd"><p>The constraint supported. Currently only
                                <code class="code">Basic</code> is implemented and supported.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">realm</code></p></td>
                    <td class="confluenceTd"><p><code class="code">null</code></p></td>
                    <td class="confluenceTd"><p>The name of the JAAS security realm. This option
                            is mandatory.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">securityConstraint</code></p></td>
                    <td class="confluenceTd"><p><code class="code">null</code></p></td>
                    <td class="confluenceTd"><p>Allows to plugin a security constraint mapper
                            where you can define ACL to web resources.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">securityAuthenticator</code></p></td>
                    <td class="confluenceTd"><p><code class="code">null</code></p></td>
                    <td class="confluenceTd"><p>Allows to plugin a authenticator that performs
                            the authentication. If none has been configured then the
                                <code class="code">org.apache.camel.component.netty4.http.JAASSecurityAuthenticator</code>
                            is used by default.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">loginDeniedLoggingLevel</code></p></td>
                    <td class="confluenceTd"><p><code class="code">DEBUG</code></p></td>
                    <td class="confluenceTd"><p>Logging level used when a login attempt failed,
                            which allows to see more details why the login failed.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">roleClassName</code></p></td>
                    <td class="confluenceTd"><p><code class="code">null</code></p></td>
                    <td class="confluenceTd"><p>To specify FQN class names of
                                <code class="code">Principal</code> implementations that contains user roles. If
                            none has been specified, then the Netty4 HTTP component will by default
                            assume a <code class="code">Principal</code> is role based if its FQN classname has
                            the lower-case word <code class="code">role</code> in its classname. You can specify
                            multiple class names separated by comma.</p></td>
                </tr></tbody></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scroll-bookmark-364"></a>Message Headers</h2></div></div></div><p>The following headers can be used on the producer to control the HTTP request.</p><table class="confluenceTable" id="d0e138501"><tbody><tr>
                    <th class="confluenceTh"><p>Name</p></th>
                    <th class="confluenceTh"><p>Type</p></th>
                    <th class="confluenceTh"><p>Description</p></th>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">CamelHttpMethod</code></p></td>
                    <td class="confluenceTd"><p><code class="code">String</code></p></td>
                    <td class="confluenceTd"><p>Allow to control what HTTP method to use such as
                            GET, POST, TRACE etc. The type can also be a
                                <code class="code">io.netty.handler.codec.http.HttpMethod</code>
                        instance.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">CamelHttpQuery</code></p></td>
                    <td class="confluenceTd"><p><code class="code">String</code></p></td>
                    <td class="confluenceTd"><p>Allows to provide URI query parameters as a
                                <code class="code">String</code> value that overrides the endpoint configuration.
                            Separate multiple parameters using the &amp; sign. For example:
                                <code class="code">foo=bar&amp;beer=yes</code>.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">CamelHttpPath</code></p></td>
                    <td class="confluenceTd"><p><code class="code">String</code></p></td>
                    <td class="confluenceTd"><p>Allows to provide URI context-path and query
                            parameters as a <code class="code">String</code> value that overrides the endpoint
                            configuration. This allows to reuse the same producer for calling same
                            remote http server, but using a dynamic context-path and query
                            parameters.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">Content-Type</code></p></td>
                    <td class="confluenceTd"><p><code class="code">String</code></p></td>
                    <td class="confluenceTd"><p>To set the content-type of the HTTP body. For
                            example: <code class="code">text/plain; charset="UTF-8"</code>.</p></td>
                </tr><tr>
                    <td><code class="literal">CamelHttpResponseCode</code></td>
                    <td><code class="literal">int</code>
                    </td>
                    <td> Allows to set the HTTP Status code to use. By default 200 is used for
                        success, and 500 for failure.</td>
                </tr></tbody></table><p>The following headers is provided as meta-data when a route starts from an Netty4 HTTP
            endpoint:</p><p>The description in the table takes offset in a route having:
                <code class="code">from("netty4-http:http:0.0.0.0:8080/myapp")...</code></p><table class="confluenceTable" id="d0e138616"><tbody><tr>
                    <th class="confluenceTh"><p>Name</p></th>
                    <th class="confluenceTh"><p>Type</p></th>
                    <th class="confluenceTh"><p>Description</p></th>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">CamelHttpMethod</code></p></td>
                    <td class="confluenceTd"><p><code class="code">String</code></p></td>
                    <td class="confluenceTd"><p>The HTTP method used, such as GET, POST, TRACE
                            etc.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">CamelHttpUrl</code></p></td>
                    <td class="confluenceTd"><p><code class="code">String</code></p></td>
                    <td class="confluenceTd"><p>The URL including protocol, host and port,
                            etc:</p><pre class="programlisting">http://0.0.0.0:8080/myapp</pre></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">CamelHttpUri</code></p></td>
                    <td class="confluenceTd"><p><code class="code">String</code></p></td>
                    <td class="confluenceTd"><p>The URI without protocol, host and port,
                            etc:</p><pre class="programlisting">/myapp</pre></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">CamelHttpQuery</code></p></td>
                    <td class="confluenceTd"><p><code class="code">String</code></p></td>
                    <td class="confluenceTd"><p>Any query parameters, such as
                                <code class="code">foo=bar&amp;beer=yes</code></p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">CamelHttpRawQuery</code></p></td>
                    <td class="confluenceTd"><p><code class="code">String</code></p></td>
                    <td class="confluenceTd"><p>Any query parameters, such as
                                <code class="code">foo=bar&amp;beer=yes</code>. Stored in the raw form, as they
                            arrived to the consumer (i.e. before URL decoding).</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">CamelHttpPath</code></p></td>
                    <td class="confluenceTd"><p><code class="code">String</code></p></td>
                    <td class="confluenceTd"><p>Additional context-path. This value is empty if
                            the client called the context-path <code class="code">/myapp</code>. If the client
                            calls <code class="code">/myapp/mystuff</code>, then this header value is
                                <code class="code">/mystuff</code>. In other words its the value after the
                            context-path configured on the route endpoint.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">CamelHttpCharacterEncoding</code></p></td>
                    <td class="confluenceTd"><p><code class="code">String</code></p></td>
                    <td class="confluenceTd"><p>The charset from the content-type
                        header.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">CamelHttpAuthentication</code></p></td>
                    <td class="confluenceTd"><p><code class="code">String</code></p></td>
                    <td class="confluenceTd"><p>If the user was authenticated using HTTP Basic
                            then this header is added with the value <code class="code">Basic</code>.</p></td>
                </tr><tr>
                    <td class="confluenceTd"><p><code class="code">Content-Type</code></p></td>
                    <td class="confluenceTd"><p><code class="code">String</code></p></td>
                    <td class="confluenceTd"><p>The content type if provided. For example:
                                <code class="code">text/plain; charset="UTF-8"</code>.</p></td>
                </tr></tbody></table></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scroll-bookmark-365"></a>Access to Netty types</h2></div></div></div><p>This component uses the
                <code class="code">org.apache.camel.component.netty4.http.NettyHttpMessage</code> as the message
            implementation on the <a class="link" href="http://localhost:8090/display/CAMEL/Exchange" target="_top">Exchange</a>. This allows end users to get access to the original Netty
            request/response instances if needed, as shown below. Mind that the original response
            may not be accessible at all times.</p><div class="informalexample"><pre class="programlisting">io.netty.handler.codec.http.HttpRequest request = exchange.getIn(NettyHttpMessage.class).getHttpRequest();</pre></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scroll-bookmark-366"></a>Examples</h2></div></div></div><p>In the route below we use Netty4 HTTP as a HTTP server, which returns back a hardcoded
            "Bye World" message.</p><div class="informalexample"><pre class="programlisting">    from("netty4-http:http://0.0.0.0:8080/foo")
      .transform().constant("Bye World");</pre></div><p>And we can call this HTTP server using Camel also, with the <a class="link" href="http://localhost:8090/display/CAMEL/ProducerTemplate" target="_top">ProducerTemplate</a> as shown below:</p><div class="informalexample"><pre class="programlisting">    String out = template.requestBody("netty4-http:http://localhost:8080/foo", "Hello World", String.class);
    System.out.println(out);</pre></div><p>And we get back "Bye World" as the output.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scroll-bookmark-367"></a>How do I let Netty match wildcards</h2></div></div></div><p>By default Netty4 HTTP will only match on exact uri's. But you can instruct Netty to
            match prefixes. For example</p><div class="informalexample"><pre class="programlisting">from("netty4-http:http://0.0.0.0:8123/foo").to("mock:foo");</pre></div><p>In the route above Netty4 HTTP will only match if the uri is an exact match, so it
            will match if you enter <code class="code">http://0.0.0.0:8123/foo</code> but not match if you do
                <code class="code">http://0.0.0.0:8123/foo/bar</code>.</p><p>So if you want to enable wildcard matching you do as follows:</p><div class="informalexample"><pre class="programlisting">from("netty4-http:http://0.0.0.0:8123/foo?matchOnUriPrefix=true").to("mock:foo");</pre></div><p>So now Netty matches any endpoints with starts with <code class="code">foo</code>.</p><p>To match <span class="strong"><strong>any</strong></span> endpoint you can do:</p><div class="informalexample"><pre class="programlisting">from("netty4-http:http://0.0.0.0:8123?matchOnUriPrefix=true").to("mock:foo");</pre></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scroll-bookmark-368"></a>Using multiple routes with same port</h2></div></div></div><p>In the same <a class="link" href="http://localhost:8090/display/CAMEL/CamelContext" target="_top">CamelContext</a> you can have multiple routes from Netty4 HTTP that shares the
            same port (eg a <code class="code">io.netty.bootstrap.ServerBootstrap</code> instance). Doing this
            requires a number of bootstrap options to be identical in the routes, as the routes will
            share the same <code class="code">io.netty.bootstrap.ServerBootstrap</code> instance. The instance
            will be configured with the options from the first route created.</p><p>The options the routes must be identical configured is all the options defined in the
                <code class="code">org.apache.camel.component.netty4.NettyServerBootstrapConfiguration</code>
            configuration class. If you have configured another route with different options, Camel
            will throw an exception on startup, indicating the options is not identical. To mitigate
            this ensure all options is identical.</p><p>Here is an example with two routes that share the same port.</p><div class="example"><a name="d0e138887"></a><p class="title"><b>Example&nbsp;9.&nbsp;Two routes sharing the same port</b></p><div class="example-contents"><pre class="programlisting">from("netty4-http:http://0.0.0.0:{{port}}/foo")
  .to("mock:foo")
  .transform().constant("Bye World");

from("netty4-http:http://0.0.0.0:{{port}}/bar")
  .to("mock:bar")
  .transform().constant("Bye Camel");</pre></div></div><br class="example-break"><p>And here is an example of a mis configured 2nd route that do not have identical
                <code class="code">org.apache.camel.component.netty4.NettyServerBootstrapConfiguration</code>
            option as the 1st route. This will cause Camel to fail on startup.</p><div class="example"><a name="d0e138897"></a><p class="title"><b>Example&nbsp;10.&nbsp;Two routes sharing the same port, but the 2nd route is misconfigured and will
                fail on starting</b></p><div class="example-contents"><pre class="programlisting">from("netty4-http:http://0.0.0.0:{{port}}/foo")
  .to("mock:foo")
  .transform().constant("Bye World");

// we cannot have a 2nd route on same port with SSL enabled, when the 1st route is NOT
from("netty4-http:http://0.0.0.0:{{port}}/bar?ssl=true")
  .to("mock:bar")
  .transform().constant("Bye Camel");</pre></div></div><br class="example-break"></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scroll-bookmark-369"></a>Reusing same server bootstrap configuration with multiple routes</h2></div></div></div><p>By configuring the common server bootstrap option in an single instance of a
                <code class="code">org.apache.camel.component.netty4.NettyServerBootstrapConfiguration</code>
            type, we can use the <code class="code">bootstrapConfiguration</code> option on the Netty4 HTTP
            consumers to refer and reuse the same options across all consumers.</p><div class="informalexample"><pre class="programlisting">&lt;bean id="nettyHttpBootstrapOptions" class="org.apache.camel.component.netty4.NettyServerBootstrapConfiguration"&gt;
  &lt;property name="backlog" value="200"/&gt;
  &lt;property name="connectionTimeout" value="20000"/&gt;
  &lt;property name="workerCount" value="16"/&gt;
&lt;/bean&gt;</pre></div><p>And in the routes you refer to this option as shown below</p><div class="informalexample"><pre class="programlisting">&lt;route&gt;
  &lt;from uri="netty4-http:http://0.0.0.0:{{port}}/foo?bootstrapConfiguration=#nettyHttpBootstrapOptions"/&gt;
  ...
&lt;/route&gt;

&lt;route&gt;
  &lt;from uri="netty4-http:http://0.0.0.0:{{port}}/bar?bootstrapConfiguration=#nettyHttpBootstrapOptions"/&gt;
  ...
&lt;/route&gt;

&lt;route&gt;
  &lt;from uri="netty4-http:http://0.0.0.0:{{port}}/beer?bootstrapConfiguration=#nettyHttpBootstrapOptions"/&gt;
  ...
&lt;/route&gt;</pre></div></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scroll-bookmark-370"></a>Reusing same server bootstrap configuration with multiple routes across multiple
            bundles in OSGi container</h2></div></div></div><p>See the <a class="link" href="http://localhost:8090/display/CAMEL/Netty+HTTP+Server+Example" target="_top">Netty HTTP Server Example</a> for more details and example how to do
            that.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scroll-bookmark-371"></a>Using HTTP Basic Authentication</h2></div></div></div><p>The Netty HTTP consumer supports HTTP basic authentication by specifying the security
            realm name to use, as shown below</p><div class="informalexample"><pre class="programlisting">&lt;route&gt;
   &lt;from uri="netty4-http:http://0.0.0.0:{{port}}/foo?securityConfiguration.realm=karaf"/&gt;
   ...
&lt;/route&gt;</pre></div><p>The realm name is mandatory to enable basic authentication. By default the JAAS based
            authenticator is used, which will use the realm name specified (karaf in the example
            above) and use the JAAS realm and the JAAS {{LoginModule}}s of this realm for
            authentication.</p><p>End user of Apache Karaf / ServiceMix has a karaf realm out of the box, and hence why
            the example above would work out of the box in these containers.</p></div><div class="simplesect"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scroll-bookmark-372"></a>Specifying ACL on web resources</h2></div></div></div><p>The <code class="code">org.apache.camel.component.netty4.http.SecurityConstraint</code> allows to
            define constrains on web resources. And the
                <code class="code">org.apache.camel.component.netty.http.SecurityConstraintMapping</code> is
            provided out of the box, allowing to easily define inclusions and exclusions with
            roles.</p><p>For example as shown below in the XML DSL, we define the constraint bean:</p><div class="informalexample"><pre class="programlisting">  &lt;bean id="constraint" class="org.apache.camel.component.netty4.http.SecurityConstraintMapping"&gt;
    &lt;!-- inclusions defines url -&gt; roles restrictions --&gt;
    &lt;!-- a * should be used for any role accepted (or even no roles) --&gt;
    &lt;property name="inclusions"&gt;
      &lt;map&gt;
        &lt;entry key="/*" value="*"/&gt;
        &lt;entry key="/admin/*" value="admin"/&gt;
        &lt;entry key="/guest/*" value="admin,guest"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;!-- exclusions is used to define public urls, which requires no authentication --&gt;
    &lt;property name="exclusions"&gt;
      &lt;set&gt;
        &lt;value&gt;/public/*&lt;/value&gt;
      &lt;/set&gt;
    &lt;/property&gt;
  &lt;/bean&gt;</pre></div><p>The constraint above is define so that</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>access to /* is restricted and any roles is accepted (also if user has no
                    roles)</p></li><li class="listitem"><p>access to /admin/* requires the admin role</p></li><li class="listitem"><p>access to /guest/* requires the admin or guest role</p></li><li class="listitem"><p>access to /public/* is an exclusion which means no authentication is needed,
                    and is therefore public for everyone without logging in</p></li></ul></div><p>To use this constraint we just need to refer to the bean id as shown below:</p><div class="informalexample"><pre class="programlisting">&lt;route&gt;
   &lt;from uri="netty4-http:http://0.0.0.0:{{port}}/foo?matchOnUriPrefix=true&amp;amp;securityConfiguration.realm=karaf&amp;amp;securityConfiguration.securityConstraint=#constraint"/&gt;
   ...
&lt;/route&gt;</pre></div></div></div></body></html>