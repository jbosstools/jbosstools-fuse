<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>SQL Stored Procedure Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="sql-component.html" title="SQL Component"><link rel="next" href="ssh-component.html" title="SSH Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="sql-stored-component"></a>SQL Stored Procedure Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="sql-stored-component.html#_uri_format_192">URI format</a></span></dt><dt><span class="section"><a href="sql-stored-component.html#_options_143">Options</a></span></dt><dt><span class="section"><a href="sql-stored-component.html#_declaring_the_stored_procedure_template">Declaring the stored procedure template</a></span></dt><dt><span class="section"><a href="sql-stored-component.html#_camel_sql_starter_2">Camel Sql Starter</a></span></dt><dt><span class="section"><a href="sql-stored-component.html#_see_also_129">See Also</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.17</strong></span></p><p>The <span class="strong"><strong>sql-stored:</strong></span> component allows you to work with databases using JDBC
Stored Procedure queries. This component is an extension to
the&nbsp;<a class="link" href="sql-component.html" title="SQL Component">SQL Component</a> but specialized for calling
stored procedures.</p><p>This component uses <code class="literal">spring-jdbc</code> behind the scenes for the actual SQL
handling.</p><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-sql<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_192"></a>URI format</h2></div></div></div><p>The SQL component uses the following endpoint URI notation:</p><pre class="programlisting">sql-stored:template[?options]</pre><p>Where template is the stored procedure template, where you declare the
name of the stored procedure and the IN, INOUT, and OUT arguments.&nbsp;</p><p>You can also refer to the template in a external file on the file system
or classpath such as:</p><pre class="programlisting">sql-stored:classpath:sql/myprocedure.sql[?options]</pre><p>Where sql/myprocedure.sql is a plain text file in the classpath with the
template, as show:</p><pre class="programlisting">SUBNUMBERS(
  INTEGER ${headers.num1},
  INTEGER ${headers.num2},
  INOUT INTEGER ${headers.num3} out1,
  OUT INTEGER out2
)</pre><p>You can append query options to the URI in the following format,
<code class="literal">?option=value&amp;option=value&amp;&#8230;&#8203;</code></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_143"></a>Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="sql-stored-component.html#_path_parameters_1_parameters_167">Path Parameters (1 parameters):</a></span></dt><dt><span class="section"><a href="sql-stored-component.html#_query_parameters_7_parameters_12">Query Parameters (7 parameters):</a></span></dt></dl></div><p>The SQL Stored Procedure component supports 2 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>dataSource</strong></span> (producer)</p></td><td align="left" valign="top"><p>Sets the DataSource to use to communicate with the database.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>DataSource</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resolveProperty Placeholders</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether the component should resolve property placeholders on itself when starting. Only properties which are of String type can use property placeholders.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div><p>The SQL Stored Procedure endpoint is configured using URI syntax:</p><pre class="screen">sql-stored:template</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_1_parameters_167"></a>Path Parameters (1 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>template</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Sets the StoredProcedure template to perform</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_7_parameters_12"></a>Query Parameters (7 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>batch</strong></span> (producer)</p></td><td align="left" valign="top"><p>Enables or disables batch mode</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>dataSource</strong></span> (producer)</p></td><td align="left" valign="top"><p>Sets the DataSource to use to communicate with the database.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>DataSource</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>function</strong></span> (producer)</p></td><td align="left" valign="top"><p>Whether this call is for a function.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>noop</strong></span> (producer)</p></td><td align="left" valign="top"><p>If set, will ignore the results of the template and use the existing IN message as the OUT message for the continuation of processing</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>outputHeader</strong></span> (producer)</p></td><td align="left" valign="top"><p>Store the template result in a header instead of the message body. By default, outputHeader == null and the template result is stored in the message body, any existing content in the message body is discarded. If outputHeader is set, the value is used as the name of the header to store the template result and the original message body is preserved.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>useMessageBodyForTemplate</strong></span> (producer)</p></td><td align="left" valign="top"><p>Whether to use the message body as the template and then headers for parameters. If this option is enabled then the template in the uri is not used.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_declaring_the_stored_procedure_template"></a>Declaring the stored procedure template</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="sql-stored-component.html#_in_parameters">IN Parameters</a></span></dt><dt><span class="section"><a href="sql-stored-component.html#_out_parameters">OUT Parameters</a></span></dt><dt><span class="section"><a href="sql-stored-component.html#_inout_parameters">INOUT Parameters</a></span></dt></dl></div><p>The template is declared using a syntax that would be similar to a Java
method signature. The name of the stored procedure, and then the
arguments enclosed in parenthesis. An example explains this well:</p><pre class="programlisting">&lt;to uri=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"sql-stored:STOREDSAMPLE(INTEGER ${headers.num1},INTEGER ${headers.num2},INOUT INTEGER ${headers.num3} result1,OUT INTEGER result2)"</em></strong>/&gt;</pre><p>The arguments are declared by a type and then a mapping to the Camel
message using simple expression. So, in this example the first two
parameters are IN values of INTEGER type, mapped to the message
headers. The third parameter is INOUT, meaning it accepts an INTEGER
and then returns a different INTEGER result. The last parameter is
the OUT value, also an INTEGER type.</p><p>In SQL term the stored procedure could be declared as:</p><pre class="programlisting">CREATE PROCEDURE STOREDSAMPLE(VALUE1 INTEGER, VALUE2 INTEGER, INOUT RESULT1 INTEGER, OUT RESULT2 INTEGER)</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_in_parameters"></a>IN Parameters</h3></div></div></div><p>IN parameters take four parts separated by a space: parameter name, SQL type (with scale), type name and value source.</p><p>Parameter name is optional and will be auto generated if not provided. It must be given between quotes(').</p><p>SQL type is required and can be an integer (positive or negative) or reference to integer field in some class.
If SQL type contains a dot then component tries resolve that class and read the given field. For example
SQL type com.Foo.INTEGER is read from the field INTEGER of class com.Foo. If the type doesn&#8217;t
contain comma then class to resolve the integer value will be java.sql.Types.
Type can be postfixed by scale for example DECIMAL(10) would mean java.sql.Types.DECIMAL with scale 10.</p><p>Type name is optional and must be given between quotes(').</p><p>Value source is required. Value source populates the parameter value from the Exchange.
It can be either a Simple expression or header location i.e. :#&lt;header name&gt;. For example
Simple expression ${header.val} would mean that parameter value will be read from the header "val".
Header location expression :#val would have identical effect.</p><pre class="programlisting">&lt;to uri=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"sql-stored:MYFUNC('param1' org.example.Types.INTEGER(10) ${header.srcValue})"</em></strong>/&gt;</pre><p>URI means that the stored procedure will be called with parameter name "param1",
it&#8217;s SQL type is read from field INTEGER of class org.example.Types and scale will be set to 10.
Input value for the parameter is passed from the header "srcValue".</p><pre class="programlisting">&lt;to uri=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"sql-stored:MYFUNC('param1' 100 'mytypename' ${header.srcValue})"</em></strong>/&gt;</pre><p>URI is identical to previous on except SQL-type is 100 and type name is "mytypename".</p><p>Actual call will be done using org.springframework.jdbc.core.SqlParameter.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_out_parameters"></a>OUT Parameters</h3></div></div></div><p>OUT parameters work similarly IN parameters and contain three parts: SQL type(with scale), type name and output parameter name.</p><p>SQL type works the same as IN parameters.</p><p>Type name is optional and also works the same as IN parameters.</p><p>Output parameter name is used for the OUT parameter name, as well as the header name where the result will be stored.</p><pre class="programlisting">&lt;to uri=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"sql-stored:MYFUNC(OUT org.example.Types.DECIMAL(10) outheader1)"</em></strong>/&gt;</pre><p>URI means that OUT parameter&#8217;s name is "outheader1" and result will be but into header "outheader1".</p><pre class="programlisting">&lt;to uri=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"sql-stored:MYFUNC(OUT org.example.Types.NUMERIC(10) 'mytype' outheader1)"</em></strong>/&gt;</pre><p>This is identical to previous one but type name will be "mytype".</p><p>Actual call will be done using org.springframework.jdbc.core.SqlOutParameter.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_inout_parameters"></a>INOUT Parameters</h3></div></div></div><p>INOUT parameters are a combination of all of the above.  They receive a value from the exchange, as well as store a
result as a message header.  The only caveat is that the IN parameter&#8217;s "name" is skipped.  Instead, the OUT
parameter&#8217;s "name" defines both the SQL parameter name, as well as the result header name.</p><pre class="programlisting">&lt;to uri=<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"sql-stored:MYFUNC(INOUT DECIMAL(10) ${headers.inheader} outheader)"</em></strong>/&gt;</pre><p>Actual call will be done using org.springframework.jdbc.core.SqlInOutParameter.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_camel_sql_starter_2"></a>Camel Sql Starter</h2></div></div></div><p>A starter module is available to spring-boot users. When using the starter,
the <code class="literal">DataSource</code> can be directly configured using spring-boot properties.</p><pre class="screen"># Example for a mysql datasource
spring.datasource.url=jdbc:mysql://localhost/test
spring.datasource.username=dbuser
spring.datasource.password=dbpass
spring.datasource.driver-class-name=com.mysql.jdbc.Driver</pre><p>To use this feature, add the following dependencies to your spring boot pom.xml file:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-sql-starter<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>${camel.version}<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong> <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong>

<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.springframework.boot<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>spring-boot-starter-jdbc<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>${spring-boot-version}<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><p>You should also include the specific database driver, if needed.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_see_also_129"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Configuring Camel</li><li class="listitem">Component</li><li class="listitem">Endpoint</li><li class="listitem">Getting Started</li><li class="listitem"><a class="link" href="sql-component.html" title="SQL Component">SQL Component</a></li></ul></div></div></div></body></html>