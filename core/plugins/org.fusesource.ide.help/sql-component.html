<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>SQL Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="spring-ws-component.html" title="Spring WebService Component"><link rel="next" href="sql-stored-component.html" title="SQL Stored Procedure Component"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="sql-component"></a>SQL Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="sql-component.html#_uri_format_191">URI format</a></span></dt><dt><span class="section"><a href="sql-component.html#_options_142">Options</a></span></dt><dt><span class="section"><a href="sql-component.html#_treatment_of_the_message_body">Treatment of the message body</a></span></dt><dt><span class="section"><a href="sql-component.html#_result_of_the_query_2">Result of the query</a></span></dt><dt><span class="section"><a href="sql-component.html#_using_streamlist">Using StreamList</a></span></dt><dt><span class="section"><a href="sql-component.html#_header_values_2">Header values</a></span></dt><dt><span class="section"><a href="sql-component.html#_generated_keys_2">Generated keys</a></span></dt><dt><span class="section"><a href="sql-component.html#_configuration_5">Configuration</a></span></dt><dt><span class="section"><a href="sql-component.html#_sample_9">Sample</a></span></dt><dt><span class="section"><a href="sql-component.html#JDBC-IDEMPOTENT-REPO">Using the JDBC-based idempotent repository</a></span></dt><dt><span class="section"><a href="sql-component.html#JDBC-AGGREGATOR-REPO">Using the JDBC-based aggregation repository</a></span></dt><dt><span class="section"><a href="sql-component.html#_camel_sql_starter">Camel SQL Starter</a></span></dt><dt><span class="section"><a href="sql-component.html#_see_also_128">See Also</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 1.4</strong></span></p><p>The <span class="strong"><strong>sql:</strong></span> component allows you to work with databases using JDBC
queries. The difference between this component and <a class="link" href="jdbc-component.html" title="JDBC Component">JDBC</a>
component is that in case of SQL the query is a property of the endpoint
and it uses message payload as parameters passed to the query.</p><p>This component uses <code class="literal">spring-jdbc</code> behind the scenes for the actual SQL
handling.</p><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-sql<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><p>The SQL component also supports:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">JDBC-based repository for the Idempotent Consumer EIP pattern. See <a class="xref" href="sql-component.html#JDBC-IDEMPOTENT-REPO" title="Using the JDBC-based idempotent repository">Using the JDBC-based idempotent repository</a>.</li><li class="listitem">JDBC-based repository for the Aggregator EIP pattern. See <a class="xref" href="sql-component.html#JDBC-AGGREGATOR-REPO" title="Using the JDBC-based aggregation repository">Using the JDBC-based aggregation repository</a>.</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_191"></a>URI format</h2></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="imagesdb/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>From Camel 2.11 onwards this component can create both consumer (e.g. <code class="literal">from()</code>)
and producer endpoints (e.g. <code class="literal">to()</code>). In previous versions, it could only act as a producer.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>This component can be used as a
<a class="link" href="http://camel.apache.org/transactional-client.html" target="_top">Transactional Client</a>.</p></td></tr></table></div><p>The SQL component uses the following endpoint URI notation:</p><pre class="programlisting">sql:select * from table where id=# order by name[?options]</pre><p>From Camel 2.11 onwards you can use named parameters by using <code class="literal">#name_of_the_parameter</code> style as shown:</p><pre class="programlisting">sql:select * from table where id=:#myId order by name[?options]</pre><p>When using named parameters, Camel will lookup the names from, in the
given precedence:
 1. From message body if its a <code class="literal">java.util.Map</code>
 2. From message headers</p><p>If a named parameter cannot be resolved, an exception is thrown.</p><p>From <span class="strong"><strong>Camel 2.14</strong></span> onward you can use Simple expressions as parameters as
shown:</p><pre class="programlisting">sql:select * from table where id=:#${property.myId} order by name[?options]</pre><p>Notice that the standard <code class="literal">?</code> symbol that denotes the parameters to an
SQL query is substituted with the <code class="literal">#</code> symbol, because the <code class="literal">?</code> symbol is
used to specify options for the endpoint. The <code class="literal">?</code> symbol replacement can
be configured on endpoint basis.</p><p>From <span class="strong"><strong>Camel 2.17</strong></span> onwards you can externalize your SQL queries to files
in the classpath or file system as shown:</p><pre class="programlisting">sql:classpath:sql/myquery.sql[?options]</pre><p>And the <code class="literal">myquery.sql</code> file is in the classpath and is just a plain text:</p><pre class="programlisting">-- <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">this</strong> is a comment
select *
from table
where
  id = :#${property.myId}
order by
  name</pre><p>In the file you can use multilines and format the SQL as you wish. And
also use comments such as the&nbsp;&#8211; dash line.</p><p>You can append query options to the URI in the following format,
<code class="literal">?option=value&amp;option=value&amp;&#8230;&#8203;</code></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_142"></a>Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="sql-component.html#_path_parameters_1_parameters_166">Path Parameters (1 parameters):</a></span></dt><dt><span class="section"><a href="sql-component.html#_query_parameters_45_parameters">Query Parameters (45 parameters):</a></span></dt></dl></div><p>The SQL component supports 3 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>dataSource</strong></span> (common)</p></td><td align="left" valign="top"><p>Sets the DataSource to use to communicate with the database.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>DataSource</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>usePlaceholder</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether to use placeholder and replace all placeholder characters with sign in the SQL queries. This option is default true</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resolveProperty Placeholders</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether the component should resolve property placeholders on itself when starting. Only properties which are of String type can use property placeholders.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div><p>The SQL endpoint is configured using URI syntax:</p><pre class="screen">sql:query</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_1_parameters_166"></a>Path Parameters (1 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>query</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> Sets the SQL query to perform. You can externalize the query by using file: or classpath: as prefix and specify the location of the file.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_45_parameters"></a>Query Parameters (45 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>allowNamedParameters</strong></span> (common)</p></td><td align="left" valign="top"><p>Whether to allow using named parameters in the queries.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>dataSource</strong></span> (common)</p></td><td align="left" valign="top"><p>Sets the DataSource to use to communicate with the database.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>DataSource</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>dataSourceRef</strong></span> (common)</p></td><td align="left" valign="top"><p><span class="strong"><strong>Deprecated</strong></span> Sets the reference to a DataSource to lookup from the registry, to use for communicating with the database.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>outputClass</strong></span> (common)</p></td><td align="left" valign="top"><p>Specify the full package and class name to use as conversion when outputType=SelectOne.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>outputHeader</strong></span> (common)</p></td><td align="left" valign="top"><p>Store the query result in a header instead of the message body. By default, outputHeader == null and the query result is stored in the message body, any existing content in the message body is discarded. If outputHeader is set, the value is used as the name of the header to store the query result and the original message body is preserved.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>outputType</strong></span> (common)</p></td><td align="left" valign="top"><p>Make the output of consumer or producer to SelectList as List of Map, or SelectOne as single Java object in the following way: a) If the query has only single column, then that JDBC Column object is returned. (such as SELECT COUNT( ) FROM PROJECT will return a Long object. b) If the query has more than one column, then it will return a Map of that result. c) If the outputClass is set, then it will convert the query result into an Java bean object by calling all the setters that match the column names. It will assume your class has a default constructor to create instance with. d) If the query resulted in more than one rows, it throws an non-unique result exception.</p></td><td align="center" valign="top"><p>SelectList</p></td><td align="left" valign="top"><p>SqlOutputType</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>separator</strong></span> (common)</p></td><td align="left" valign="top"><p>The separator to use when parameter values is taken from message body (if the body is a String type), to be inserted at placeholders. Notice if you use named parameters, then a Map type is used instead. The default value is comma.</p></td><td align="center" valign="top"><p>,</p></td><td align="left" valign="top"><p>char</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>breakBatchOnConsumeFail</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets whether to break batch if onConsume failed.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>expectedUpdateCount</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets an expected update count to validate when using onConsume.</p></td><td align="center" valign="top"><p>-1</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>maxMessagesPerPoll</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the maximum number of messages to poll</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>onConsume</strong></span> (consumer)</p></td><td align="left" valign="top"><p>After processing each row then this query can be executed, if the Exchange was processed successfully, for example to mark the row as processed. The query can have parameter.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>onConsumeBatchComplete</strong></span> (consumer)</p></td><td align="left" valign="top"><p>After processing the entire batch, this query can be executed to bulk update rows etc. The query cannot have parameters.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>onConsumeFailed</strong></span> (consumer)</p></td><td align="left" valign="top"><p>After processing each row then this query can be executed, if the Exchange failed, for example to mark the row as failed. The query can have parameter.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>routeEmptyResultSet</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets whether empty resultset should be allowed to be sent to the next hop. Defaults to false. So the empty resultset will be filtered out.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>sendEmptyMessageWhenIdle</strong></span> (consumer)</p></td><td align="left" valign="top"><p>If the polling consumer did not poll any files, you can enable this option to send an empty message (no body) instead.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>transacted</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Enables or disables transaction. If enabled then if processing an exchange failed then the consumer break out processing any further exchanges to cause a rollback eager</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>useIterator</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets how resultset should be delivered to route. Indicates delivery as either a list or individual object. defaults to true.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>pollStrategy</strong></span> (consumer)</p></td><td align="left" valign="top"><p>A pluggable org.apache.camel.PollingConsumerPollingStrategy allowing you to provide your custom implementation to control error handling usually occurred during the poll operation before an Exchange have been created and being routed in Camel.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>PollingConsumerPoll Strategy</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>processingStrategy</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows to plugin to use a custom org.apache.camel.component.sql.SqlProcessingStrategy to execute queries when the consumer has processed the rows/batch.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>SqlProcessingStrategy</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>batch</strong></span> (producer)</p></td><td align="left" valign="top"><p>Enables or disables batch mode</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>noop</strong></span> (producer)</p></td><td align="left" valign="top"><p>If set, will ignore the results of the SQL query and use the existing IN message as the OUT message for the continuation of processing</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>useMessageBodyForSql</strong></span> (producer)</p></td><td align="left" valign="top"><p>Whether to use the message body as the SQL and then headers for parameters. If this option is enabled then the SQL in the uri is not used.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>alwaysPopulateStatement</strong></span> (producer)</p></td><td align="left" valign="top"><p>If enabled then the populateStatement method from org.apache.camel.component.sql.SqlPrepareStatementStrategy is always invoked, also if there is no expected parameters to be prepared. When this is false then the populateStatement is only invoked if there is 1 or more expected parameters to be set; for example this avoids reading the message body/headers for SQL queries with no parameters.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>parametersCount</strong></span> (producer)</p></td><td align="left" valign="top"><p>If set greater than zero, then Camel will use this count value of parameters to replace instead of querying via JDBC metadata API. This is useful if the JDBC vendor could not return correct parameters count, then user may override instead.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>placeholder</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Specifies a character that will be replaced to in SQL query. Notice, that it is simple String.replaceAll() operation and no SQL parsing is involved (quoted strings will also change).</p></td><td align="center" valign="top"><p>#</p></td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>prepareStatementStrategy</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Allows to plugin to use a custom org.apache.camel.component.sql.SqlPrepareStatementStrategy to control preparation of the query and prepared statement.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>SqlPrepareStatement Strategy</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>templateOptions</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Configures the Spring JdbcTemplate with the key/values from the Map</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Map</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>usePlaceholder</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether to use placeholder and replace all placeholder characters with sign in the SQL queries. This option is default true</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>backoffErrorThreshold</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>The number of subsequent error polls (failed due some error) that should happen before the backoffMultipler should kick-in.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>backoffIdleThreshold</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>The number of subsequent idle polls that should happen before the backoffMultipler should kick-in.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>backoffMultiplier</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>To let the scheduled polling consumer backoff if there has been a number of subsequent idles/errors in a row. The multiplier is then the number of polls that will be skipped before the next actual attempt is happening again. When this option is in use then backoffIdleThreshold and/or backoffErrorThreshold must also be configured.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>delay</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Milliseconds before the next poll. You can also specify time values using units, such as 60s (60 seconds), 5m30s (5 minutes and 30 seconds), and 1h (1 hour).</p></td><td align="center" valign="top"><p>500</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>greedy</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>If greedy is enabled, then the ScheduledPollConsumer will run immediately again, if the previous run polled 1 or more messages.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>initialDelay</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Milliseconds before the first poll starts. You can also specify time values using units, such as 60s (60 seconds), 5m30s (5 minutes and 30 seconds), and 1h (1 hour).</p></td><td align="center" valign="top"><p>1000</p></td><td align="left" valign="top"><p>long</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>runLoggingLevel</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>The consumer logs a start/complete log line when it polls. This option allows you to configure the logging level for that.</p></td><td align="center" valign="top"><p>TRACE</p></td><td align="left" valign="top"><p>LoggingLevel</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>scheduledExecutorService</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Allows for configuring a custom/shared thread pool to use for the consumer. By default each consumer has its own single threaded thread pool.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ScheduledExecutor Service</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>scheduler</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>To use a cron scheduler from either camel-spring or camel-quartz2 component</p></td><td align="center" valign="top"><p>none</p></td><td align="left" valign="top"><p>ScheduledPollConsumer Scheduler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>schedulerProperties</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>To configure additional properties when using a custom scheduler or any of the Quartz2, Spring based scheduler.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>Map</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>startScheduler</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Whether the scheduler should be auto started.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>timeUnit</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Time unit for initialDelay and delay options.</p></td><td align="center" valign="top"><p>MILLISECONDS</p></td><td align="left" valign="top"><p>TimeUnit</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>useFixedDelay</strong></span> (scheduler)</p></td><td align="left" valign="top"><p>Controls if fixed delay or fixed rate is used. See ScheduledExecutorService in JDK for details.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_treatment_of_the_message_body"></a>Treatment of the message body</h2></div></div></div><p>The SQL component tries to convert the message body to an object of
<code class="literal">java.util.Iterator</code> type and then uses this iterator to fill the query
parameters (where each query parameter is represented by a <code class="literal">#</code> symbol
(or configured placeholder) in the endpoint URI). If the message body is
not an array or collection, the conversion results in an iterator that
iterates over only one object, which is the body itself.</p><p>For example, if the message body is an instance of <code class="literal">java.util.List</code>, the
first item in the list is substituted into the first occurrence of <code class="literal">#</code>
in the SQL query, the second item in the list is substituted into the
second occurrence of <code class="literal">#</code>, and so on.</p><p>If <code class="literal">batch</code> is set to <code class="literal">true</code>, then the interpretation of the inbound
message body changes slightly &#8211; instead of an iterator of parameters,
the component expects an iterator that contains the parameter iterators;
the size of the outer iterator determines the batch size.</p><p>From Camel 2.16 onwards you can use the option&nbsp;useMessageBodyForSql that
allows to use the message body as the SQL statement, and then the SQL
parameters must be provided in a header with the
key&nbsp;SqlConstants.SQL_PARAMETERS. This allows the SQL component to work
more dynamic as the SQL query is from the message body.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_result_of_the_query_2"></a>Result of the query</h2></div></div></div><p>For <code class="literal">select</code> operations, the result is an instance of
<code class="literal">List&lt;Map&lt;String, Object&gt;&gt;</code> type, as returned by the
<a class="link" href="http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/jdbc/core/JdbcTemplate.html#queryForList(java.lang.String,%20java.lang.Object%91%93)" target="_top">JdbcTemplate.queryForList()</a>
method. For <code class="literal">update</code> operations, the result is the number of updated
rows, returned as an <code class="literal">Integer</code>.</p><p>By default, the result is placed in the message body.&nbsp; If the
outputHeader parameter is set, the result is placed in the header.&nbsp; This
is an alternative to using a full message enrichment pattern to add
headers, it provides a concise syntax for querying a sequence or some
other small value into a header.&nbsp; It is convenient to use outputHeader
and outputType together:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jms:order.inbox"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"sql:select order_seq.nextval from dual?outputHeader=OrderId&amp;outputType=SelectOne"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"jms:order.booking"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_streamlist"></a>Using StreamList</h2></div></div></div><p>From <span class="strong"><strong>Camel 2.18</strong></span> onwards the producer supports <code class="literal">outputType=StreamList</code>
that uses an iterator to stream the output of the query. This allows to
process the data in a streaming fashion which for example can be used by
the&nbsp;Splitter EIP to process each row one at a time,
and load data from the database as needed.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:withSplitModel"</em></strong>)
        .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"sql:select * from projects order by id?outputType=StreamList&amp;outputClass=org.apache.camel.component.sql.ProjectModel"</em></strong>)
        .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"log:stream"</em></strong>)
        .split(body()).streaming()
            .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"log:row"</em></strong>)
            .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:result"</em></strong>)
        .end();</pre><p>&nbsp;</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_header_values_2"></a>Header values</h2></div></div></div><p>When performing <code class="literal">update</code> operations, the SQL Component stores the update
count in the following message headers:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="90%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Header</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">CamelSqlUpdateCount</code></p></td><td align="left" valign="top"><p>The number of rows updated for <code class="literal">update</code> operations, returned as an
<code class="literal">Integer</code> object. This header&nbsp;is not provided when using
outputType=StreamList.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelSqlRowCount</code></p></td><td align="left" valign="top"><p>The number of rows returned for <code class="literal">select</code> operations, returned as an
<code class="literal">Integer</code> object. This header&nbsp;is not provided when using
outputType=StreamList.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelSqlQuery</code></p></td><td align="left" valign="top"><p><span class="strong"><strong>Camel 2.8:</strong></span> Query to execute. This query takes precedence over the
query specified in the endpoint URI. Note that query parameters in the
header <span class="emphasis"><em>are</em></span> represented by a <code class="literal">?</code> instead of a <code class="literal">#</code> symbol</p></td></tr></tbody></table></div><p>When performing&nbsp;<code class="literal">insert</code> operations, the SQL Component stores the rows
with the generated keys and number of these rown in the following
message headers (<span class="strong"><strong>Available as of Camel 2.12.4, 2.13.1</strong></span>):</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="90%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Header</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>CamelSqlGeneratedKeysRowCount</p></td><td align="left" valign="top"><p>The number of rows in the header that contains generated keys.</p></td></tr><tr><td align="left" valign="top"><p>CamelSqlGeneratedKeyRows</p></td><td align="left" valign="top"><p>Rows that contains the generated keys (a list of maps of keys).</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_generated_keys_2"></a>Generated keys</h2></div></div></div><p><span class="strong"><strong>Available as of Camel 2.12.4, 2.13.1 and 2.14</strong></span></p><p>If you insert data using SQL INSERT, the RDBMS may support auto
generated keys. You can instruct the SQL producer to return the
generated keys in headers.
 To do this, set the header <code class="literal">CamelSqlRetrieveGeneratedKeys=true</code>. Then
the generated keys will be provided as headers with the keys listed in
the table above.</p><p>You can see more details in this
<a class="link" href="https://gitbox.apache.org/repos/asf?p=camel.git;a=blob;f=components/camel-sql/src/test/java/org/apache/camel/component/sql/SqlGeneratedKeysTest.java;h=54c19b7332bb0aa81ee24ff3d3a66885a6b9e9aa;hb=HEAD" target="_top">unit test</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_configuration_5"></a>Configuration</h2></div></div></div><p>You can now set a reference to a <code class="literal">DataSource</code> in the URI directly:</p><pre class="programlisting">sql:select * from table where id=# order by name?dataSource=myDS</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_sample_9"></a>Sample</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="sql-component.html#_using_named_parameters_2">Using named parameters</a></span></dt><dt><span class="section"><a href="sql-component.html#_using_expression_parameters">Using expression parameters</a></span></dt><dt><span class="section"><a href="sql-component.html#_using_in_queries_with_dynamic_values">Using IN queries with dynamic values</a></span></dt></dl></div><p>In the sample below we execute a query and retrieve the result as a
<code class="literal">List</code> of rows, where each row is a <code class="literal">Map&lt;String, Object</code> and the key is
the column name.</p><p>First, we set up a table to use for our sample. As this is based on an
unit test, we do it in java:</p><p>The SQL script <code class="literal">createAndPopulateDatabase.sql</code> we execute looks like as
described below:</p><p>Then we configure our route and our <code class="literal">sql</code> component. Notice that we use
a <code class="literal">direct</code> endpoint in front of the <code class="literal">sql</code> endpoint. This allows us to
send an exchange to the <code class="literal">direct</code> endpoint with the URI, <code class="literal">direct:simple</code>,
which is much easier for the client to use than the long <code class="literal">sql:</code> URI.
Note that the <code class="literal">DataSource</code> is looked up up in the registry, so we can
use standard Spring XML to configure our <code class="literal">DataSource</code>.</p><p>And then we fire the message into the <code class="literal">direct</code> endpoint that will route
it to our <code class="literal">sql</code> component that queries the database.</p><p>We could configure the <code class="literal">DataSource</code> in Spring XML as follows:</p><pre class="programlisting"> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;jee:jndi-lookup</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"myDS"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">jndi-name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"jdbc/myDataSource"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_using_named_parameters_2"></a>Using named parameters</h3></div></div></div><p><span class="strong"><strong>Available as of Camel 2.11</strong></span></p><p>In the given route below, we want to get all the projects from the
projects table. Notice the SQL query has 2 named parameters, :#lic and
:#min.
 Camel will then lookup for these parameters from the message body or
message headers. Notice in the example above we set two headers with
constant value
 for the named parameters:</p><pre class="programlisting">   from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:projects"</em></strong>)
     .setHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"lic"</em></strong>, constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"ASF"</em></strong>))
     .setHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"min"</em></strong>, constant(<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">123</span>))
     .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"sql:select * from projects where license = :#lic and id &gt; :#min order by id"</em></strong>)</pre><p>Though if the message body is a <code class="literal">java.util.Map</code> then the named
parameters will be taken from the body.</p><pre class="programlisting">   from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:projects"</em></strong>)
     .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"sql:select * from projects where license = :#lic and id &gt; :#min order by id"</em></strong>)</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_using_expression_parameters"></a>Using expression parameters</h3></div></div></div><p><span class="strong"><strong>Available as of Camel 2.14</strong></span></p><p>In the given route below, we want to get all the project from the
database. It uses the body of the exchange for defining the license and
uses the value of a property as the second parameter.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:projects"</em></strong>)
  .setBody(constant(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"ASF"</em></strong>))
  .setProperty(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"min"</em></strong>, constant(<span xmlns="http://www.w3.org/1999/xhtml" class="hl-number">123</span>))
  .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"sql:select * from projects where license = :#${body} and id &gt; :#${property.min} order by id"</em></strong>)</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_using_in_queries_with_dynamic_values"></a>Using IN queries with dynamic values</h3></div></div></div><p><span class="strong"><strong>Available as of Camel 2.17</strong></span></p><p>From Camel 2.17 onwards the SQL producer allows to use SQL queries with
IN statements where the IN values is dynamic computed. For example from
the message body or a header etc.</p><p>To use IN you need to:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Prefix the parameter name with&nbsp;<code class="literal">in:</code></li><li class="listitem">Add <code class="literal">( )</code>&nbsp;around the parameter</li></ul></div><p>An example explains this better. The following query is used:</p><pre class="programlisting">-- <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">this</strong> is a comment
select *
from projects
where project in (:#in:names)
order by id</pre><p>In the following route:</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:query"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"sql:classpath:sql/selectProjectsIn.sql"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"log:query"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:query"</em></strong>);</pre><p>Then the IN query can use a header with the key names with the dynamic
values such as:</p><pre class="programlisting"><em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// use an array</em>
template.requestBodyAndHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:query"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Hi there!"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"names"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> String[]{<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Camel"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"AMQ"</em></strong>});


<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// use a list</em>
List&lt;String&gt; names = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> ArrayList&lt;String&gt;();
names.add(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Camel"</em></strong>);
names.add(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"AMQ"</em></strong>);

template.requestBodyAndHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:query"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Hi there!"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"names"</em></strong>, names);


<em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// use a string separated values with comma</em>
template.requestBodyAndHeader(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:query"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Hi there!"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"names"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"Camel,AMQ"</em></strong>);</pre><p>The query can also be specified in the endpoint instead of being
externalized (notice that externalizing makes maintaining the SQL
queries easier)</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:query"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"sql:select * from projects where project in (:#in:names) order by id"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"log:query"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:query"</em></strong>);</pre><p>&nbsp;</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="JDBC-IDEMPOTENT-REPO"></a>Using the JDBC-based idempotent repository</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="sql-component.html#_customize_the_jdbcmessageidrepository">Customize the JdbcMessageIdRepository</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel 2.7</strong></span>: In this section we will use the JDBC based
idempotent repository.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="imagesdb/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>Abstract class</strong></span>
From Camel 2.9 onwards there is an abstract class
<code class="literal">org.apache.camel.processor.idempotent.jdbc.AbstractJdbcMessageIdRepository</code>
you can extend to build custom JDBC idempotent repository.</p></td></tr></table></div><p>First we have to create the database table which will be used by the
idempotent repository. For <span class="strong"><strong>Camel 2.7</strong></span>, we use the following schema:</p><pre class="programlisting">CREATE TABLE CAMEL_MESSAGEPROCESSED ( processorName VARCHAR(255),
messageId VARCHAR(100) )</pre><p>&nbsp;</p><p>In <span class="strong"><strong>Camel 2.8</strong></span>, we added the createdAt column:</p><pre class="programlisting">CREATE TABLE CAMEL_MESSAGEPROCESSED ( processorName VARCHAR(255),
messageId VARCHAR(100), createdAt TIMESTAMP )</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="imagesdb/warning.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>The SQL Server&nbsp;<span class="strong"><strong>TIMESTAMP</strong></span> type is a fixed-length binary-string type. It
does not map to any of the JDBC time types: <span class="strong"><strong>DATE</strong></span>, <span class="strong"><strong>TIME</strong></span>, or <span class="strong"><strong>TIMESTAMP</strong></span>.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_customize_the_jdbcmessageidrepository"></a>Customize the JdbcMessageIdRepository</h3></div></div></div><p>Starting with <span class="strong"><strong>Camel 2.9.1</strong></span> you have a few options to tune the
<code class="literal">org.apache.camel.processor.idempotent.jdbc.JdbcMessageIdRepository</code> for
your needs:</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="10%" class="col_1"><col width="10%" class="col_2"><col width="80%" class="col_3"></colgroup><thead><tr><th align="left" valign="top">Parameter</th><th align="left" valign="top">Default Value</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>createTableIfNotExists</p></td><td align="left" valign="top"><p>true</p></td><td align="left" valign="top"><p>Defines whether or not Camel should try to create the table if it
doesn&#8217;t exist.</p></td></tr><tr><td align="left" valign="top"><p>tableExistsString</p></td><td align="left" valign="top"><p>SELECT 1 FROM CAMEL_MESSAGEPROCESSED WHERE 1 = 0</p></td><td align="left" valign="top"><p>This query is used to figure out whether the table already exists or
not. It must throw an exception to indicate the table doesn&#8217;t exist.</p></td></tr><tr><td align="left" valign="top"><p>createString</p></td><td align="left" valign="top"><p>CREATE TABLE CAMEL_MESSAGEPROCESSED (processorName VARCHAR(255),
messageId VARCHAR(100), createdAt TIMESTAMP)</p></td><td align="left" valign="top"><p>The statement which is used to create the table.</p></td></tr><tr><td align="left" valign="top"><p>queryString</p></td><td align="left" valign="top"><p>SELECT COUNT(*) FROM CAMEL_MESSAGEPROCESSED WHERE processorName = ? AND
messageId = ?</p></td><td align="left" valign="top"><p>The query which is used to figure out whether the message already exists
in the repository (the result is not equals to '0'). It takes two
parameters. This first one is the processor name (<code class="literal">String</code>) and the
second one is the message id (<code class="literal">String</code>).</p></td></tr><tr><td align="left" valign="top"><p>insertString</p></td><td align="left" valign="top"><p>INSERT INTO CAMEL_MESSAGEPROCESSED (processorName, messageId, createdAt)
VALUES (?, ?, ?)</p></td><td align="left" valign="top"><p>The statement which is used to add the entry into the table. It takes
three parameter. The first one is the processor name (<code class="literal">String</code>), the
second one is the message id (<code class="literal">String</code>) and the third one is the
timestamp (<code class="literal">java.sql.Timestamp</code>) when this entry was added to the
repository.</p></td></tr><tr><td align="left" valign="top"><p>deleteString</p></td><td align="left" valign="top"><p>DELETE FROM CAMEL_MESSAGEPROCESSED WHERE processorName = ? AND messageId
= ?</p></td><td align="left" valign="top"><p>The statement which is used to delete the entry from the database. It
takes two parameter. This first one is the processor name (<code class="literal">String</code>) and
the second one is the message id (<code class="literal">String</code>).</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="JDBC-AGGREGATOR-REPO"></a>Using the JDBC-based aggregation repository</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="sql-component.html#_database">Database</a></span></dt><dt><span class="section"><a href="sql-component.html#_storing_body_and_headers_as_text">Storing body and headers as text</a></span></dt><dt><span class="section"><a href="sql-component.html#_codec_serialization">Codec (Serialization)</a></span></dt><dt><span class="section"><a href="sql-component.html#_transaction">Transaction</a></span></dt><dt><span class="section"><a href="sql-component.html#_aggregator_configuration">Aggregator configuration</a></span></dt><dt><span class="section"><a href="sql-component.html#_optimistic_locking">Optimistic locking</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel 2.6</strong></span></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>Using JdbcAggregationRepository in Camel 2.6</strong></span></p></td></tr></table></div><p>In Camel 2.6, the JdbcAggregationRepository is provided in the
<code class="literal">camel-jdbc-aggregator</code> component. From Camel 2.7 onwards, the
<code class="literal">JdbcAggregationRepository</code> is provided in the <code class="literal">camel-sql</code> component.</p><p><code class="literal">JdbcAggregationRepository</code> is an <code class="literal">AggregationRepository</code> which on the
fly persists the aggregated messages. This ensures that you will not
lose messages, as the default aggregator will use an in memory only
<code class="literal">AggregationRepository</code>. The <code class="literal">JdbcAggregationRepository</code> allows together with Camel to provide
persistent support for the Aggregator.</p><p>Only when an Exchange has been successfully
processed it will be marked as complete which happens when the <code class="literal">confirm</code>
method is invoked on the <code class="literal">AggregationRepository</code>. This means if the same
Exchange fails again it will be retried until successful.</p><p>You can use option <code class="literal">maximumRedeliveries</code> to limit the maximum number of
redelivery attempts for a given recovered Exchange.
You must also set the <code class="literal">deadLetterUri</code> option so Camel knows where to
send the Exchange when the <code class="literal">maximumRedeliveries</code> was
hit.</p><p>You can see some examples in the unit tests of camel-sql, for example
<a class="link" href="https://svn.apache.org/repos/asf/camel/trunk/components/camel-sql/src/test/java/org/apache/camel/processor/aggregate/jdbc/JdbcAggregateRecoverDeadLetterChannelTest.java" target="_top">this
test</a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_database"></a>Database</h3></div></div></div><p>To be operational, each aggregator uses two table: the aggregation and
completed one. By convention the completed has the same name as the
aggregation one suffixed with <code class="literal">"_COMPLETED"</code>. The name must be
configured in the Spring bean with the <code class="literal">RepositoryName</code> property. In the
following example aggregation will be used.</p><p>The table structure definition of both table are identical: in both case
a String value is used as key (<span class="strong"><strong>id</strong></span>) whereas a Blob contains the
exchange serialized in byte array.
 However one difference should be remembered: the <span class="strong"><strong>id</strong></span> field does not
have the same content depending on the table.
 In the aggregation table <span class="strong"><strong>id</strong></span> holds the correlation Id used by the
component to aggregate the messages. In the completed table, <span class="strong"><strong>id</strong></span> holds
the id of the exchange stored in corresponding the blob field.</p><p>Here is the SQL query used to create the tables, just replace
<code class="literal">"aggregation"</code> with your aggregator repository name.</p><pre class="programlisting">CREATE TABLE aggregation ( id varchar(255) NOT NULL, exchange blob NOT
NULL, constraint aggregation_pk PRIMARY KEY (id) ); CREATE TABLE
aggregation_completed ( id varchar(255) NOT NULL, exchange blob NOT
NULL, constraint aggregation_completed_pk PRIMARY KEY (id) );</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_storing_body_and_headers_as_text"></a>Storing body and headers as text</h3></div></div></div><p><span class="strong"><strong>Available as of Camel 2.11</strong></span></p><p>You can configure the <code class="literal">JdbcAggregationRepository</code> to store message body
and select(ed) headers as String in separate columns. For example to
store the body, and the following two headers <code class="literal">companyName</code> and
<code class="literal">accountName</code> use the following SQL:</p><pre class="programlisting">CREATE TABLE aggregationRepo3 ( id varchar(255) NOT NULL, exchange blob
NOT NULL, body varchar(1000), companyName varchar(1000), accountName
varchar(1000), constraint aggregationRepo3_pk PRIMARY KEY (id) ); CREATE
TABLE aggregationRepo3_completed ( id varchar(255) NOT NULL, exchange
blob NOT NULL, body varchar(1000), companyName varchar(1000),
accountName varchar(1000), constraint aggregationRepo3_completed_pk
PRIMARY KEY (id) );</pre><p>&nbsp;</p><p>And then configure the repository to enable this behavior as shown
below:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"repo3"</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.processor.aggregate.jdbc.JdbcAggregationRepository"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"repositoryName"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"aggregationRepo3"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"transactionManager"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"txManager3"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"dataSource"</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"dataSource3"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong> <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- configure to store the message body and
following headers as text in the repo --&gt;</em> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"storeBodyAsText"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"true"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"headersToStoreAsText"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;list&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;value&gt;</strong>companyName<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/value&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;value&gt;</strong>accountName<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/value&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/list&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/property&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_codec_serialization"></a>Codec (Serialization)</h3></div></div></div><p>Because they can contain any type of payload, Exchanges are not
serializable by design. It is converted into a byte array to be stored
in a database BLOB field. All those conversions are handled by the
<code class="literal">JdbcCodec</code> class. One detail of the code requires your attention: the
<code class="literal">ClassLoadingAwareObjectInputStream</code>.</p><p>The <code class="literal">ClassLoadingAwareObjectInputStream</code> has been reused from the
<a class="link" href="http://activemq.apache.org/" target="_top">Apache ActiveMQ</a> project. It wraps an
<code class="literal">ObjectInputStream</code> and use it with the <code class="literal">ContextClassLoader</code> rather than
the <code class="literal">currentThread</code> one. The benefit is to be able to load classes
exposed by other bundles. This allows the exchange body and headers to
have custom types object references.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_transaction"></a>Transaction</h3></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="sql-component.html#_service_start_stop">Service (Start/Stop)</a></span></dt></dl></div><p>A Spring <code class="literal">PlatformTransactionManager</code> is required to orchestrate
transactions.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_service_start_stop"></a>Service (Start/Stop)</h4></div></div></div><p>The <code class="literal">start</code> method verifies the connection of the database and the
presence of the required tables. If anything is wrong it will fail
during starting.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_aggregator_configuration"></a>Aggregator configuration</h3></div></div></div><p>Depending on the targeted environment, the aggregator might need some
configuration. As you already know, each aggregator should have its own
repository (with the corresponding pair of table created in the
database) and a data source. If the default lobHandler is not adapted to
your database system, it can be injected with the <code class="literal">lobHandler</code> property.</p><p>Here is the declaration for Oracle:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"lobHandler"</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.springframework.jdbc.support.lob.OracleLobHandler"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"nativeJdbcExtractor"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"nativeJdbcExtractor"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"nativeJdbcExtractor"</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.springframework.jdbc.support.nativejdbc.CommonsDbcpNativeJdbcExtractor"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"repo"</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.processor.aggregate.jdbc.JdbcAggregationRepository"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"transactionManager"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"transactionManager"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"repositoryName"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"aggregation"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"dataSource"</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"dataSource"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong> <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- Only with Oracle, else use default --&gt;</em> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"lobHandler"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"lobHandler"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_optimistic_locking"></a>Optimistic locking</h3></div></div></div><p>From <span class="strong"><strong>Camel 2.12</strong></span> onwards you can turn on <code class="literal">optimisticLocking</code> and use
this JDBC based aggregation repository in a clustered environment where
multiple Camel applications shared the same database for the aggregation
repository. If there is a race condition there JDBC driver will throw a
vendor specific exception which the <code class="literal">JdbcAggregationRepository</code> can
react upon. To know which caused exceptions from the JDBC driver is
regarded as an optimistick locking error we need a mapper to do this.
Therefore there is a
<code class="literal">org.apache.camel.processor.aggregate.jdbc.JdbcOptimisticLockingExceptionMapper</code>
allows you to implement your custom logic if needed. There is a default
implementation
<code class="literal">org.apache.camel.processor.aggregate.jdbc.DefaultJdbcOptimisticLockingExceptionMapper</code>
which works as follows:</p><p>The following check is done:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">If the caused exception is an <code class="literal">SQLException</code> then the SQLState is
checked if starts with 23.</li><li class="listitem">If the caused exception is a <code class="literal">DataIntegrityViolationException</code></li><li class="listitem">If the caused exception class name has "ConstraintViolation" in its
name.</li><li class="listitem">Optional checking for FQN class name matches if any class names has been
configured</li></ul></div><p>You can in addition add FQN classnames, and if any of the caused
exception (or any nested) equals any of the FQN class names, then its an
optimistick locking error.</p><p>Here is an example, where we define 2 extra FQN class names from the
JDBC vendor:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"repo"</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.processor.aggregate.jdbc.JdbcAggregationRepository"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"transactionManager"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"transactionManager"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"repositoryName"</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">value</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"aggregation"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"dataSource"</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"dataSource"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name"jdbcOptimisticLockingExceptionMapper"</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">ref</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"myExceptionMapper"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">/&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong> <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the default mapper with extra
FQN class names from our JDBC driver --&gt;</em> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;bean</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">id</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"myExceptionMapper"</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">class</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"org.apache.camel.processor.aggregate.jdbc.DefaultJdbcOptimisticLockingExceptionMapper"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;property</strong> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-attribute" style="color: #F5844C">name</span>=<span xmlns="http://www.w3.org/1999/xhtml" class="hl-value" style="color: #993300">"classNames"</span><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;util:set&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;value&gt;</strong>com.foo.sql.MyViolationExceptoion<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/value&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;value&gt;</strong>com.foo.sql.MyOtherViolationExceptoion<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/value&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/util:set&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/property&gt;</strong> <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/bean&gt;</strong></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_camel_sql_starter"></a>Camel SQL Starter</h2></div></div></div><p>A starter module is available to spring-boot users. When using the starter,
the <code class="literal">DataSource</code> can be directly configured using spring-boot properties.</p><pre class="screen"># Example for a mysql datasource
spring.datasource.url=jdbc:mysql://localhost/test
spring.datasource.username=dbuser
spring.datasource.password=dbpass
spring.datasource.driver-class-name=com.mysql.jdbc.Driver</pre><p>To use this feature, add the following dependencies to your spring boot pom.xml file:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-sql-starter<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>${camel.version}<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong> <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong>

<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.springframework.boot<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>spring-boot-starter-jdbc<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>${spring-boot-version}<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><p>You should also include the specific database driver, if needed.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_see_also_128"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Configuring Camel</li><li class="listitem">Component</li><li class="listitem">Endpoint</li><li class="listitem">Getting Started</li><li class="listitem">SQL Stored Procedure</li><li class="listitem"><a class="link" href="jdbc-component.html" title="JDBC Component">JDBC</a></li></ul></div></div></div></body></html>