<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>AWS-S3</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><meta name="keywords" content="ESB, Apache ServiceMix, Open Source, open source, integration, OSGi, enterprise service bus, Apache ServiceMix documentation, Apache Karaf, Red Hat JBoss Fuse, Red Hat JBoss Fuse documentation"><link rel="home" href="index.html" title="Red Hat JBoss Fuse Tooling for Eclipse"><link rel="up" href="IDU-AWS.html" title="AWS"><link rel="prev" href="IDU-AWS-Kinesis.html" title="AWS-Kinesis"><link rel="next" href="IDU-AWS-SDB.html" title="AWS-SDB"><link rel="copyright" href="tmdisclaim.html" title="Trademark Disclaimer"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="IDU-AWS-S3"></a>AWS-S3</h2></div></div></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="IDU-AWS-S3_HSH_S3Component"></a>S3 Component</h3></div></div></div><p><span class="bold"><strong>Available as of Camel 2.8</strong></span>
    </p><p>The S3 component supports storing and retrieving objetcs from/to <a class="link" href="http://aws.amazon.com/s3" target="_top">Amazon's S3</a> service.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important: Prerequisites"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="imagesdb/important.png"></td><th align="left">Prerequisites</th></tr><tr><td align="left" valign="top"><p>You must have a valid Amazon Web Services developer account, and be signed up to use Amazon S3. More information are available at <a class="link" href="http://aws.amazon.com/s3" target="_top">Amazon S3</a>.</p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="IDU-AWS-S3_HSH_URIFormat"></a>URI Format</h3></div></div></div><pre class="programlisting">aws-s3://bucketNameOrARN[?options]</pre><p>Where <code class="code">bucketNameOrARN</code> can be either a bucket name or an Amazon Resource Name
            (ARN). The bucket will be created if it doesn't already exists. You can append query
            options to the URI in the following format,
                <code class="code">?options=value&amp;option2=value&amp;...</code></p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="IDU-AWS-S3_HSH_URIOptions"></a>URI Options</h3></div></div></div><p></p><table id="d0e51551"><tr>
        <th> Name </th>
        <th> Default Value </th>
        <th> Context </th>
        <th> Description </th>
      </tr><tr>
        <td><code class="code">amazonS3Client</code>
                </td>
        <td><code class="literal">null</code>
        </td>
        <td> Shared </td>
        <td> Reference to a <code class="literal">com.amazonaws.services.sqs.AmazonS3</code> in the Registry. </td>
      </tr><tr>
        <td><code class="code">accessKey</code>
                </td>
        <td><code class="literal">null</code>
        </td>
        <td> Shared </td>
        <td> Amazon AWS Access Key </td>
      </tr><tr>
        <td><code class="code">secretKey</code>
                </td>
        <td><code class="literal">null</code>
        </td>
        <td> Shared </td>
        <td> Amazon AWS Secret Key </td>
      </tr><tr>
        <td><code class="code">amazonS3Endpoint</code>
                </td>
        <td><code class="literal">null</code>
        </td>
        <td> Shared </td>
        <td> The region with which the AWS-S3 client wants to work with. </td>
      </tr><tr>
        <td><code class="code">region</code>
                </td>
        <td><code class="literal">null</code>
        </td>
        <td> Producer </td>
        <td> The region who the bucket is located. This option is used in the <code class="literal">com.amazonaws.services.s3.model.CreateBucketRequest</code>. </td>
      </tr><tr>
        <td><code class="code">deleteAfterRead</code>
                </td>
        <td><code class="literal">true</code>
        </td>
        <td> Consumer </td>
        <td> Delete objects from S3 after it has been retrieved. </td>
      </tr><tr>
        <td><code class="code">deleteAfterWrite</code>
                </td>
        <td><code class="literal">false</code>
        </td>
        <td> Producer</td>
        <td><span class="bold"><strong>Camel 2.11.0</strong></span> Delete file object after the S3 file has been uploaded </td>
      </tr><tr>
        <td><code class="code">maxMessagesPerPoll</code></td>
        <td> 10 </td>
        <td> Consumer </td>
        <td> The maximum number of objects which can be retrieved in one poll. Used in in the <code class="literal">com.amazonaws.services.s3.model.ListObjectsRequest</code>. </td>
      </tr><tr>
        <td><code class="code">policy</code></td>
        <td><code class="literal">null</code>
        </td>
        <td> Shared </td>
        <td>
                    <span class="bold"><strong>Camel 2.8.4:</strong></span> The policy for this queue to set
                    in the <code class="literal">com.amazonaws.services.s3.AmazonS3#setBucketPolicy()</code>
                    method. </td>
      </tr><tr>
        <td><code class="code">storageClass</code></td>
        <td><code class="literal">null</code>
        </td>
        <td> Producer </td>
        <td>
                    <span class="bold"><strong>Camel 2.8.4:</strong></span> The storage class to set in the
                        <code class="literal">com.amazonaws.services.s3.model.PutObjectRequest</code> request. </td>
      </tr><tr>
        <td><code class="code">prefix</code>
                </td>
        <td><code class="literal">null</code>
        </td>
        <td> Consumer </td>
        <td>
                    <span class="bold"><strong>Camel 2.10.1:</strong></span> The prefix which is used in the
                        <code class="literal">com.amazonaws.services.s3.model.ListObjectsRequest</code> to
                    only consume objects we are interested in. </td>
      </tr><tr>
        <td><code class="code">multiPartUpload</code>
                </td>
        <td><code class="literal">false</code>
        </td>
        <td> Producer </td>
        <td>
          <span class="bold"><strong>Camel 2.15.0:</strong></span>  If <code class="code">true</code>, Camel uploads the
          file in multi-part format, where the part size can be specified by the
            <code class="code">partSize</code> option. </td>
      </tr><tr>
        <td><code class="code">partSize</code>
                </td>
        <td><code class="literal">25 * 1024 * 1024</code>
        </td>
        <td> Producer </td>
        <td>
          <span class="bold"><strong>Camel 2.15.0:</strong></span> Specifies the <code class="code">partSize</code> used in
          multi-part upload. Default is 25 MB. </td>
      </tr><tr>
                <td><code class="code">serverSideEncryption</code>
                </td>
                <td><code class="literal">null</code>
                </td>
                <td> Producer </td>
                <td>
                    <span class="bold"><strong>Camel 2.16:</strong></span> Sets the server-side encryption
                    algorithm when encrypting the object using AWS-managed keys. For example use
                    AES256.</td>
            </tr><tr>
                <td><code class="code">proxyHost</code>
                </td>
                <td><code class="literal">null</code>
                </td>
                <td> Producer </td>
                <td>
                    <span class="bold"><strong>Camel 2.16:</strong></span> Specify a proxy host to be used
                    inside the client definition.</td>
            </tr><tr>
                <td><code class="code">proxyPort</code>
                </td>
                <td><code class="literal">null</code>
                </td>
                <td> Producer </td>
                <td>
                    <span class="bold"><strong>Camel 2.16:</strong></span> Specify a proxy port to be used
                    inside the client definition.</td>
            </tr><tr>
                <td><code class="code">includeBody</code>
                </td>
                <td><code class="literal">null</code>
                </td>
                <td> Consumer </td>
                <td>
                    <span class="bold"><strong>Camel 2.17:</strong></span> If <code class="code">true</code>, the exchange
                    body will be set to a stream to the contents of the file. If <code class="code">false</code>,
                    the headers will be set with the S3 object metadata but the body will be
                        <code class="code">null</code>.</td>
            </tr></table><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important: Required S3 component options"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="imagesdb/important.png"></td><th align="left">Required S3 component options</th></tr><tr><td align="left" valign="top"><p>You have to provide the amazonS3Client in the Registry or your accessKey and secretKey to access the <a class="link" href="http://aws.amazon.com/s3" target="_top">Amazon's S3</a>.</p></td></tr></table></div></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="IDU-AWS-S3_HSH_BatchConsumer"></a>Batch Consumer</h3></div></div></div><p></p><p>This component implements the <a class="link" href="http://camel.apache.org/batch-consumer.html" target="_top">Batch Consumer</a>.</p><p>This allows you, for example, to know how many messages exist in this batch and let the <span class="phrase">Aggregator</span> aggregate this number of
            messages.</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="IDU-AWS-S3_HSH_Usage"></a>Usage</h3></div></div></div><p></p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="IDU-AWS-S3_HSH_MessageheadersevaluatedbytheS3producer"></a>Message headers evaluated by the S3 producer</h3></div></div></div><p></p><p>

    </p><table width="1364" id="d0e51969"><col width="308pt"><col width="494pt"><col width="554pt"><tr>
                <th> Header </th>
                <th> Type </th>
                <th> Description </th>
            </tr><tr>
                <td><code class="literal">CamelAwsS3Key</code>
                </td>
                <td><code class="literal">String</code>
                </td>
                <td> The key under which this object will be stored. </td>
            </tr><tr>
                <td><code class="literal">CamelAwsS3ContentLength</code>
                </td>
                <td><code class="literal">Long</code>
                </td>
                <td> The content length of this object. </td>
            </tr><tr>
                <td><code class="literal">CamelAwsS3ContentType</code>
                </td>
                <td><code class="literal">String</code>
                </td>
                <td> The content type of this object. </td>
            </tr><tr>
                <td><code class="literal">CamelAwsS3ContentControl</code>
                </td>
                <td><code class="literal">String</code>
                </td>
                <td>The content control of this object. </td>
            </tr><tr>
                <td><code class="literal">CamelAwsS3ContentDisposition</code>
                </td>
                <td><code class="literal">String</code>
                </td>
                <td>The content disposition of this object. </td>
            </tr><tr>
                <td><code class="literal">CamelAwsS3ContentEncoding</code>
                </td>
                <td><code class="literal">String</code>
                </td>
                <td>The content encoding of this object. </td>
            </tr><tr>
                <td><code class="literal">CamelAwsS3ContentMD5</code>
                </td>
                <td><code class="literal">String</code>
                </td>
                <td>The md5 checksum of this object. </td>
            </tr><tr>
                <td><code class="literal">CamelAwsS3LastModified</code>
                </td>
                <td><code class="literal">java.util.Date</code>
                </td>
                <td>The last modified timestamp of this object. </td>
            </tr><tr>
                <td><code class="literal">CamelAwsS3StorageClass</code>
                </td>
                <td><code class="literal">String</code>
                </td>
                <td> *Camel 2.8.4:* The storage class of this object. </td>
            </tr><tr>
                <td><code class="literal">CamelAwsS3CannedAcl</code>
                </td>
                <td><code class="literal">String</code>
                </td>
                <td><span class="bold"><strong>Camel 2.11.0:</strong></span> The canned acl that will be
                    applied to the object. see
                        <code class="literal">com.amazonaws.services.s3.model.CannedAccessControlList</code>
                    for allowed values. </td>
            </tr><tr>
                <td><code class="literal">CamelAwsS3Acl</code>
                </td>
                <td><code class="literal">com.amazonaws.services.s3.model.AccessControlList</code>
                </td>
                <td><span class="bold"><strong>Camel 2.11.0:</strong></span> A well-constructed Amazon S3
                    Access Control List object. See
                        <code class="literal">com.amazonaws.services.s3.model.AccessControlList</code> for
                    more details.</td>
            </tr><tr>
                <td><code class="literal">CamelAwsS3Headers</code>
                </td>
                <td><code class="literal">Map&lt;String,String&gt;</code>
                </td>
                <td><span class="bold"><strong>Camel 2.15.0:</strong></span> Support getting or setting custom
                        <code class="code">objectMetadata</code> headers.</td>
            </tr><tr>
                <td><code class="literal">CamelAwsS3ServerSideEncryption</code>
                </td>
                <td><code class="literal">String</code>
                </td>
                <td><span class="bold"><strong>Camel 2.16:</strong></span> Sets the server-side encryption
                    algorithm when encrypting the object using AWS-managed keys. For example use
                    AES256.</td>
            </tr></table><p>

    </p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="IDU-AWS-S3_HSH_MessageheaderssetbytheS3producer"></a>Message headers set by the S3 producer</h3></div></div></div><p></p><p>

    </p><table id="d0e52209"><tr>
        <th> Header </th>
        <th> Type </th>
        <th> Description </th>
      </tr><tr>
        <td><code class="literal">CamelAwsS3ETag</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> The ETag value for the newly uploaded object. </td>
      </tr><tr>
        <td><code class="literal">CamelAwsS3VersionId</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> The <span class="bold"><strong>optional</strong></span> version ID of the newly uploaded object. </td>
      </tr></table><p>

    </p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="IDU-AWS-S3_HSH_MessageheaderssetbytheS3consumer"></a>Message headers set by the S3 consumer</h3></div></div></div><p></p><p>

    </p><table id="d0e52267"><tr>
        <th> Header </th>
        <th> Type </th>
        <th> Description </th>
      </tr><tr>
        <td><code class="literal">CamelAwsS3Key</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> The key under which this object is stored. </td>
      </tr><tr>
        <td><code class="literal">CamelAwsS3BucketName</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> The name of the bucket in which this object is contained. </td>
      </tr><tr>
        <td><code class="literal">CamelAwsS3ETag</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> The hex encoded 128-bit MD5 digest of the associated object according to RFC 1864. This data is used as an integrity check to verify that the data received by the caller is the same data that was sent by Amazon S3. </td>
      </tr><tr>
        <td><code class="literal">CamelAwsS3LastModified</code>
        </td>
        <td><code class="literal">Date</code>
        </td>
        <td> The value of the Last-Modified header, indicating the date and time at which Amazon S3 last recorded a modification to the associated object. </td>
      </tr><tr>
        <td><code class="literal">CamelAwsS3VersionId</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> The version ID of the associated Amazon S3 object if available. Version IDs are only assigned to objects when an object is uploaded to an Amazon S3 bucket that has object versioning enabled. </td>
      </tr><tr>
        <td><code class="literal">CamelAwsS3ContentType</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> The Content-Type HTTP header, which indicates the type of content stored in the associated object. The value of this header is a standard MIME type. </td>
      </tr><tr>
        <td><code class="literal">CamelAwsS3ContentMD5</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> The base64 encoded 128-bit MD5 digest of the associated object (content - not including headers) according to RFC 1864. This data is used as a message integrity check to verify that the data received by Amazon S3 is the same data that the caller sent. </td>
      </tr><tr>
        <td><code class="literal">CamelAwsS3ContentLength</code>
        </td>
        <td><code class="literal">Long</code>
        </td>
        <td> The Content-Length HTTP header indicating the size of the associated object in bytes. </td>
      </tr><tr>
        <td><code class="literal">CamelAwsS3ContentEncoding</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> The <span class="bold"><strong>optional</strong></span> Content-Encoding HTTP header specifying what content encodings have been applied to the object and what decoding mechanisms must be applied in order to obtain the media-type referenced by the Content-Type field. </td>
      </tr><tr>
        <td><code class="literal">CamelAwsS3ContentDisposition</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> The <span class="bold"><strong>optional</strong></span> Content-Disposition HTTP header, which specifies presentational information such as the recommended filename for the object to be saved as. </td>
      </tr><tr>
        <td><code class="literal">CamelAwsS3ContentControl</code>
        </td>
        <td><code class="literal">String</code>
        </td>
        <td> The <span class="bold"><strong>optional</strong></span> Cache-Control HTTP header which allows the user to specify caching behavior along the HTTP request/reply chain. </td>
      </tr><tr>
                <td><code class="literal">CamelAwsS3ServerSideEncryption</code>
                </td>
                <td><code class="literal">String</code>
                </td>
                <td>
                    <span class="bold"><strong>Camel 2.16:</strong></span> The server-side encryption
                    algorithm when encrypting the object using AWS-managed keys.</td>
            </tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="IDU-AWS-S3_HSH_AdvancedAmazonS3configuration"></a>Advanced AmazonS3 configuration</h3></div></div></div><p>If your Camel Application is running behind a firewall or if you need to have more control over the <code class="literal">AmazonS3</code> instance configuration, you can create your own instance:</p><pre class="programlisting">AWSCredentials awsCredentials = new BasicAWSCredentials("myAccessKey", "mySecretKey");

ClientConfiguration clientConfiguration = new ClientConfiguration();
clientConfiguration.setProxyHost("http://myProxyHost");
clientConfiguration.setProxyPort(8080);

AmazonS3 client = new AmazonS3Client(awsCredentials, clientConfiguration);

registry.bind("client", client);</pre><p>and refer to it in your Camel aws-s3 component configuration:</p><pre class="programlisting">from("aws-s3://MyBucket?amazonS3Client=#client&amp;delay=5000&amp;maxMessagesPerPoll=5")
.to("mock:result");</pre></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="IDU-AWS-S3_HSH_Dependencies"></a>Dependencies</h3></div></div></div><p>Maven users will need to add the following dependency to their pom.xml.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: pom.xml"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="imagesdb/note.png"></td><th align="left">pom.xml</th></tr><tr><td align="left" valign="top"><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;artifactId&gt;camel-aws&lt;/artifactId&gt;
    &lt;version&gt;${camel-version}&lt;/version&gt;
&lt;/dependency&gt;</pre></td></tr></table></div><p>where <code class="literal">$\{camel-version\}</code> must be replaced by the actual version of Camel (2.8 or higher).</p><p>

    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a href="IDU-AWS.html" class="olink">AWS Component</a>
        </p></li></ul></div></div></div></body></html>