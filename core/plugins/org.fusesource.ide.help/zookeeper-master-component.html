<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>ZooKeeper Master Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="zookeeper-component.html" title="ZooKeeper Component"><link rel="next" href="_master_routepolicy.html" title="Master RoutePolicy"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="zookeeper-master-component"></a>ZooKeeper Master Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="zookeeper-master-component.html#_using_the_master_endpoint_2">Using the master endpoint</a></span></dt><dt><span class="section"><a href="zookeeper-master-component.html#_uri_format_219">URI format</a></span></dt><dt><span class="section"><a href="zookeeper-master-component.html#_options_178">Options</a></span></dt><dt><span class="section"><a href="zookeeper-master-component.html#_example_24">Example</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.19</strong></span></p><p>The <span class="strong"><strong>zookeeper-master:</strong></span> endpoint provides a way to ensure only a single consumer in a cluster consumes from a given endpoint;
with automatic failover if that JVM dies.</p><p>This can be very useful if you need to consume from some legacy back end which either doesn&#8217;t support concurrent
consumption or due to commercial or stability reasons you can only have a single connection at any point in time.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_using_the_master_endpoint_2"></a>Using the master endpoint</h2></div></div></div><p>Just prefix any camel endpoint with <span class="strong"><strong>zookeeper-master:someName:</strong></span> where <span class="emphasis"><em>someName</em></span> is a logical name and is
used to acquire the master lock. e.g.</p><pre class="screen">from("zookeeper-master:cheese:jms:foo").to("activemq:wine");</pre><p>The above simulates the [Exclusive Consumers](<a class="link" href="http://activemq.apache.org/exclusive-consumer.html" target="_top">http://activemq.apache.org/exclusive-consumer.html</a>) type feature in
ActiveMQ; but on any third party JMS provider which maybe doesn&#8217;t support exclusive consumers.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_219"></a>URI format</h2></div></div></div><pre class="screen">zookeeper-master:name:endpoint[?options]</pre><p>Where endpoint is any Camel endpoint you want to run in master/slave mode.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_178"></a>Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="zookeeper-master-component.html#_path_parameters_2_parameters_54">Path Parameters (2 parameters):</a></span></dt><dt><span class="section"><a href="zookeeper-master-component.html#_query_parameters_4_parameters_12">Query Parameters (4 parameters):</a></span></dt></dl></div><p>The ZooKeeper Master component supports 7 options which are listed below.</p><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>containerIdFactory</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To use a custom ContainerIdFactory for creating container ids.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ContainerIdFactory</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>zkRoot</strong></span> (consumer)</p></td><td align="left" valign="top"><p>The root path to use in zookeeper where information is stored which nodes are master/slave etc. Will by default use: /camel/zookeepermaster/clusters/master</p></td><td align="center" valign="top"><p>/camel/zookeepermaster/clusters/master</p></td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>curator</strong></span> (advanced)</p></td><td align="left" valign="top"><p>To use a custom configured CuratorFramework as connection to zookeeper ensemble.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>CuratorFramework</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>maximumConnection Timeout</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Timeout in millis to use when connecting to the zookeeper ensemble</p></td><td align="center" valign="top"><p>10000</p></td><td align="left" valign="top"><p>int</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>zooKeeperUrl</strong></span> (consumer)</p></td><td align="left" valign="top"><p>The url for the zookeeper ensemble</p></td><td align="center" valign="top"><p>localhost:2181</p></td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>zooKeeperPassword</strong></span> (security)</p></td><td align="left" valign="top"><p>The password to use when connecting to the zookeeper ensemble</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>resolveProperty Placeholders</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Whether the component should resolve property placeholders on itself when starting. Only properties which are of String type can use property placeholders.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div><p>The ZooKeeper Master endpoint is configured using URI syntax:</p><pre class="screen">zookeeper-master:groupName:consumerEndpointUri</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_2_parameters_54"></a>Path Parameters (2 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>groupName</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The name of the cluster group to use</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>consumerEndpointUri</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The consumer endpoint to use in master/slave mode</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_4_parameters_12"></a>Query Parameters (4 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_example_24"></a>Example</h2></div></div></div><p>You can protect a clustered Camel application to only consume files from one active node.</p><pre class="programlisting">    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// the file endpoint we want to consume from</em>
    String url = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:target/inbox?delete=true"</em></strong>;

    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// use the zookeeper master component in the clustered group named myGroup</em>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// to run a master/slave mode in the following Camel url</em>
    from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"zookeeper-master:myGroup:"</em></strong> + url)
        .log(name + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">" - Received file: ${file:name}"</em></strong>)
        .delay(delay)
        .log(name + <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">" - Done file:     ${file:name}"</em></strong>)
        .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"file:target/outbox"</em></strong>);</pre><p>ZooKeeper will by default connect to <code class="literal">localhost:2181</code>, but you can configure this on the component level.</p><pre class="programlisting">    MasterComponent master = <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> MasterComponent();
    master.setZooKeeperUrl(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"myzookeeper:2181"</em></strong>);</pre><p>However you can also configure the url of the ZooKeeper ensemble using environment variables.</p><pre class="literallayout">export ZOOKEEPER_URL = "myzookeeper:2181"</pre></div></div></body></html>