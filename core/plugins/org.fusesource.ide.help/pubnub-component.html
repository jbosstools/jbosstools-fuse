<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>PubNub Component</title><link rel="stylesheet" type="text/css" href="eclipse_book.css"><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Red Hat Fuse Tooling"><link rel="up" href="IDU-Components.html" title="Part&nbsp;V.&nbsp;Apache Camel Component Reference"><link rel="prev" href="_protobuf_protocol_buffers.html" title="Protobuf - Protocol Buffers"><link rel="next" href="quartz-component.html" title="Quartz Component (deprecated)"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="pubnub-component"></a>PubNub Component</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="pubnub-component.html#_uri_format_153">URI format</a></span></dt><dt><span class="section"><a href="pubnub-component.html#_options_116">Options</a></span></dt><dt><span class="section"><a href="pubnub-component.html#_message_headers_when_subscribing">Message headers when subscribing</a></span></dt><dt><span class="section"><a href="pubnub-component.html#_message_body_22">Message body</a></span></dt><dt><span class="section"><a href="pubnub-component.html#_examples_25">Examples</a></span></dt><dt><span class="section"><a href="pubnub-component.html#_see_also_103">See Also</a></span></dt></dl></div><p><span class="strong"><strong>Available as of Camel version 2.19</strong></span></p><p>Camel PubNub component can be used to communicate with the <a class="link" href="https://www.pubnub.com/" target="_top">PubNub</a> data stream network for connected devices.
This component uses pubnub <a class="link" href="https://github.com/pubnub/java" target="_top">java library</a>.</p><p>Use cases includs:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Chat rooms: Sending and receiving messages</li><li class="listitem">Locations and Connected cars: dispatching taxi cabs</li><li class="listitem">Smart sensors: Receiving data from a sensor for data visualizations</li><li class="listitem">Health: Monitoring heart rate from a patient&#8217;s wearable device</li><li class="listitem">Multiplayer gamings</li><li class="listitem">Interactive media: audience-participating voting system</li></ul></div><p>Maven users will need to add the following dependency to their <code class="literal">pom.xml</code>
for this component:</p><pre class="programlisting"><strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>org.apache.camel<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>camel-pubnub<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
    <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;version&gt;</strong>x.x.x<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">&lt;!-- use the same version as your Camel core version --&gt;</em>
<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_uri_format_153"></a>URI format</h2></div></div></div><pre class="programlisting">pubnub:channel[?options]</pre><p>Where <span class="strong"><strong>channel</strong></span> is the PubNub channel to publish or subscribe to.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_options_116"></a>Options</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="pubnub-component.html#_path_parameters_1_parameters_145">Path Parameters (1 parameters):</a></span></dt><dt><span class="section"><a href="pubnub-component.html#_query_parameters_14_parameters_9">Query Parameters (14 parameters):</a></span></dt></dl></div><p>The PubNub component has no options.</p><p>The PubNub endpoint is configured using URI syntax:</p><pre class="screen">pubnub:channel</pre><p>with the following path and query parameters:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_path_parameters_1_parameters_145"></a>Path Parameters (1 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>channel</strong></span></p></td><td align="left" valign="top"><p><span class="strong"><strong>Required</strong></span> The channel used for subscribing/publishing events</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_query_parameters_14_parameters_9"></a>Query Parameters (14 parameters):</h3></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="19%" class="col_1"><col width="51%" class="col_2"><col width="10%" class="col_3"><col width="20%" class="col_4"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th><th align="center" valign="top">Default</th><th align="left" valign="top">Type</th></tr></thead><tbody><tr><td align="left" valign="top"><p><span class="strong"><strong>uuid</strong></span> (common)</p></td><td align="left" valign="top"><p>UUID to be used as a device identifier, a default UUID is generated if not passed.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>bridgeErrorHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>withPresence</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Also subscribe to related presence information</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exceptionHandler</strong></span> (consumer)</p></td><td align="left" valign="top"><p>To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this options is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExceptionHandler</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>exchangePattern</strong></span> (consumer)</p></td><td align="left" valign="top"><p>Sets the exchange pattern when the consumer creates an exchange.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>ExchangePattern</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>operation</strong></span> (producer)</p></td><td align="left" valign="top"><p>The operation to perform. PUBLISH: Default. Send a message to all subscribers of a channel. FIRE: allows the client to send a message to BLOCKS Event Handlers. These messages will go directly to any Event Handlers registered on the channel. HERENOW: Obtain information about the current state of a channel including a list of unique user-ids currently subscribed to the channel and the total occupancy count. WHERENOW: Obtain information about the current list of channels to which a uuid is subscribed to. GETSTATE: Used to get key/value pairs specific to a subscriber uuid. State information is supplied as a JSON object of key/value pairs SETSTATE: Used to set key/value pairs specific to a subscriber uuid GETHISTORY: Fetches historical messages of a channel.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>pubnub</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Reference to a Pubnub client in the registry.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>PubNub</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>synchronous</strong></span> (advanced)</p></td><td align="left" valign="top"><p>Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported).</p></td><td align="center" valign="top"><p>false</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>authKey</strong></span> (security)</p></td><td align="left" valign="top"><p>If Access Manager is utilized, client will use this authKey in all restricted requests.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>cipherKey</strong></span> (security)</p></td><td align="left" valign="top"><p>If cipher is passed, all communicatons to/from PubNub will be encrypted.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>publishKey</strong></span> (security)</p></td><td align="left" valign="top"><p>The publish key obtained from your PubNub account. Required when publishing messages.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>secretKey</strong></span> (security)</p></td><td align="left" valign="top"><p>The secret key used for message signing.</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>secure</strong></span> (security)</p></td><td align="left" valign="top"><p>Use SSL for secure transmission.</p></td><td align="center" valign="top"><p>true</p></td><td align="left" valign="top"><p>boolean</p></td></tr><tr><td align="left" valign="top"><p><span class="strong"><strong>subscribeKey</strong></span> (security)</p></td><td align="left" valign="top"><p>The subscribe key obtained from your PubNub account. Required when subscribing to channels or listening for presence events</p></td><td align="center" valign="top">&nbsp;</td><td align="left" valign="top"><p>String</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_message_headers_when_subscribing"></a>Message headers when subscribing</h2></div></div></div><div class="informaltable"><table border="1" width="100%"><colgroup><col width="20%" class="col_1"><col width="80%" class="col_2"></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">CamelPubNubTimeToken</code></p></td><td align="left" valign="top"><p>The Timestamp for the event.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">CamelPubNubChannel</code></p></td><td align="left" valign="top"><p>The channel for which the message belongs.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_message_body_22"></a>Message body</h2></div></div></div><p>The message body can contain any JSON serializable data, including: Objects, Arrays, Ints and Strings. Message data should not contain special Java V4 classes or functions as these will not serialize. String content can include any single-byte or multi-byte UTF-8</p><p>Object serialization when sending is done automatically. Just pass the full object as the message payload. PubNub will takes care of object serialization.</p><p>When receiving the message body utilize objects provided by the PubNub API.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_examples_25"></a>Examples</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="pubnub-component.html#_publishing_events">Publishing events</a></span></dt><dt><span class="section"><a href="pubnub-component.html#_fire_events_aka_blocks_event_handlers">Fire events aka BLOCKS Event Handlers</a></span></dt><dt><span class="section"><a href="pubnub-component.html#_subscribing_to_events">Subscribing to events</a></span></dt><dt><span class="section"><a href="pubnub-component.html#_performing_operations">Performing operations</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_publishing_events"></a>Publishing events</h3></div></div></div><p>Default operation when producing.
The following snippet publish the event generated by PojoBean to the channel iot.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"timer:mytimer"</em></strong>)
    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// generate some data as POJO.</em>
    .bean(PojoBean.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"pubnub:iot?publishKey=mypublishKey"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_fire_events_aka_blocks_event_handlers"></a>Fire events aka BLOCKS Event Handlers</h3></div></div></div><p>See <a class="link" href="https://www.pubnub.com/blocks-catalog/" target="_top">https://www.pubnub.com/blocks-catalog/</a> for all kind of serverless functions that can be invoked.
Example of geolocation lookup</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"timer:geotimer"</em></strong>)
    .process(exchange -&gt; exchange.getIn().setBody(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">new</strong> Foo(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"bar"</em></strong>, <strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"TEXT"</em></strong>)))
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"pubnub:eon-maps-geolocation-input?operation=fire&amp;publishKey=mypubkey&amp;subscribeKey=mysubkey"</em></strong>);

from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"pubnub:eon-map-geolocation-output?subscribeKey=mysubkey)
</em></strong>    <em xmlns="http://www.w3.org/1999/xhtml" class="hl-comment" style="color: silver">// geolocation output will be logged here</em>
    .log(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"${body}"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_subscribing_to_events"></a>Subscribing to events</h3></div></div></div><p>The following snippet listens for events on the iot channel.
If you can add the option withPresens, you will also receive channel Join, Leave asf events.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"pubnub:iot?subscribeKey=mySubscribeKey"</em></strong>)
    .log(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"${body}"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:result"</em></strong>);</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_performing_operations"></a>Performing operations</h3></div></div></div><p>herenow : Obtain information about the current state of a channel including a list of unique user-ids currently subscribed to the channel and the total occupancy count of the channel</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:control"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"pubnub:myChannel?publishKey=mypublishKey&amp;subscribeKey=mySubscribeKey&amp;operation=herenow"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:result"</em></strong>);</pre><p>wherenow : Obtain information about the current list of channels to which a uuid is subscribed</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:control"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"pubnub:myChannel?publishKey=mypublishKey&amp;subscribeKey=mySubscribeKey&amp;operation=wherenow&amp;uuid=spyonme"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"mock:result"</em></strong>);</pre><p>setstate : Used to set key/value pairs specific to a subscriber uuid.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:control"</em></strong>)
    .bean(StateGenerator.<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"pubnub:myChannel?publishKey=mypublishKey&amp;subscribeKey=mySubscribeKey&amp;operation=setstate&amp;uuid=myuuid"</em></strong>);</pre><p>gethistory : Fetches historical messages of a channel.</p><pre class="programlisting">from(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"direct:control"</em></strong>)
    .to(<strong xmlns="http://www.w3.org/1999/xhtml" class="hl-string"><em style="color:red">"pubnub:myChannel?publishKey=mypublishKey&amp;subscribeKey=mySubscribeKey&amp;operation=gethistory"</em></strong>);</pre><p>There is a couple of examples in test directory that shows some of the PubNub features.
They require a PubNub account, from where you can obtain a publish- and subscribe key.</p><p>The example PubNubSensorExample already contains a subscribe key provided by PubNub, so this is ready to run without a account.
The example illustrates the PubNub component subscribing to a infinite stream of sensor data.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_see_also_103"></a>See Also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Configuring Camel</li><li class="listitem">Component</li><li class="listitem">Endpoint</li><li class="listitem">Getting Started</li><li class="listitem"><a class="link" href="rss-component.html" title="RSS Component">RSS</a></li></ul></div></div></div></body></html>